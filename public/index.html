<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RECARGAS DHARCK STORE</title>
    <!-- La ruta /image/logo1.png asume que 'logo1.png' está en la carpeta 'public/image/' en tu proyecto de Vercel. -->
    <link rel="icon" href="/image/logo1.png" type="image/png">
</head>
<body>

    <style>
        /* Fuentes */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #4A00E0, #8E2DE2, #FF00FF, #00FFFF, #00FF00); /* Degradado más claro y vibrante */
            background-size: 400% 400%;
            animation: gradient-animation 20s ease infinite; /* Animación más lenta y suave */

            display: flex;
            flex-direction: column; /* Cambiado a columna para apilar el header y el form-container */
            align-items: center;
            justify-content: flex-start; /* Alinear arriba para el header fijo */
            min-height: 100vh;
            margin: 0;
            position: relative;
            overflow-x: hidden;
            padding: 0; /* Remover padding aquí, se gestionará en el header y form-container */
            box-sizing: border-box;
        }
      
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .background-logo {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%; /* Un poco más grande para llenar más el espacio */
            max-width: 1200px; /* Limita el tamaño máximo */
            height: auto;
            opacity: 0.1; /* Más opaco para un fondo sutil */
            z-index: -2;
            pointer-events: none;
        }

        /* NUEVO ESTILO: Header de título */
        .app-header {
            width: 100%;
            background: linear-gradient(to right, #1A004B, #6A0DAD, #1A004B); /* Degradado oscuro y vibrante para el header */
            padding: 15px 0; /* Padding vertical */
            box-shadow: 0 5px 25px rgba(138, 43, 226, 0.8), 0 0 40px rgba(0, 255, 255, 0.5); /* Sombra intensa */
            z-index: 100; /* Asegurar que esté por encima de todo */
            position: sticky; /* Se queda en la parte superior al hacer scroll */
            top: 0;
            display: flex;
            justify-content: center; /* Centrar el contenido horizontalmente */
            align-items: center; /* Centrar el contenido verticalmente */
            margin-bottom: 30px; /* Espacio entre el header y el formulario */
            border-bottom: 2px solid #00FFFF; /* Borde inferior de neón */
        }

        .dharck-store-title-container {
            display: flex;
            align-items: center;
            justify-content: center; /* Centrar dentro del header */
            width: 100%; /* Ocupar todo el ancho disponible del header */
            max-width: 900px; /* Limitar ancho del contenido del título */
            padding: 0 20px; /* Padding horizontal para el contenido del título */
            box-sizing: border-box;
        }
        .dharck-store-title {
            /* Colores más definidos para el texto del título */
            color: #00FFFF; /* Cian brillante, más legible */
            text-shadow: 0 0 10px rgba(0, 255, 255, 1), 0 0 20px rgba(0, 255, 255, 0.8), 0 0 30px rgba(0, 255, 255, 0.6); /* Resplandor cian */
            animation: none; /* Eliminar animación del título para mayor claridad */
            font-weight: bold;
            font-size: 3.5em; /* Título aún más grande */
            line-height: 1;
            margin: 0;
            margin-right: 25px; /* Más espacio entre texto y logo */
            background: none; /* Eliminar background-clip ya que ahora es color sólido */
            -webkit-background-clip: unset;
            background-clip: unset;
        }
        /* Animación para el título (si se quiere mantener algo) */
        @keyframes header-neon-glow {
            0% { text-shadow: 0 0 8px #00FFFF, 0 0 15px #00FFFF, 0 0 25px #00FFFF; }
            50% { text-shadow: 0 0 12px #00FFFF, 0 0 20px #00FFFF, 0 0 35px #00FFFF; }
            100% { text-shadow: 0 0 8px #00FFFF, 0 0 15px #00FFFF, 0 0 25px #00FFFF; }
        }
        .dharck-store-title {
            animation: header-neon-glow 1.5s infinite alternate; /* Aplicar una animación de brillo */
        }

        .title-logo {
            height: 80px; /* Logo más grande en el header */
            width: auto;
            border-radius: 50%;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.8), 0 0 35px rgba(255, 0, 255, 0.8); /* Doble resplandor neón */
            transition: transform 0.3s ease;
        }
        .title-logo:hover {
            transform: scale(1.05) rotate(5deg); /* Efecto de hover sutil */
        }

        /* Contenedor principal del formulario */
        .form-container {
            background-color: rgba(20, 0, 50, 0.85); /* Fondo más claro, con mayor opacidad */
            border: 2px solid #8E2DE2; /* Borde morado vibrante */
            padding: 30px;
            border-radius: 20px; /* Más redondeado */
            box-shadow: 0 0 40px rgba(138, 43, 226, 0.8); /* Sombra más intensa */
            max-width: 900px; /* Más ancho para el nuevo diseño */
            width: 100%;
            color: #E0F7FA; /* Texto principal más claro */
            box-sizing: border-box;
            z-index: 1;
            position: relative;
            margin-top: 20px; /* Espacio adicional para separar del header */
        }

        /* Estilo para cada grupo de formulario (label + input/select) */
        .form-group {
            margin-bottom: 25px; /* Más espacio entre grupos */
        }

        label {
            display: block;
            margin-bottom: 10px; /* Más espacio debajo de la etiqueta */
            font-weight: bold;
            color: #00FFFF; /* Cian neón */
            text-shadow: 0 0 6px rgba(0, 255, 255, 0.6);
            font-size: 1.2em; /* Etiquetas más grandes */
        }

        input[type="text"],
        input[type="tel"],
        select {
            width: 100%;
            padding: 14px; /* Más padding */
            border: 2px solid #6A0DAD; /* Borde más pronunciado */
            border-radius: 10px; /* Más redondeado */
            background-color: rgba(30, 0, 60, 0.9); /* Fondo oscuro con ligera transparencia */
            color: #FFFFFF; /* Texto blanco */
            font-size: 1.15em; /* Texto un poco más grande */
            transition: all 0.3s ease;
            box-shadow: inset 0 0 8px rgba(106, 13, 173, 0.3); /* Sombra interna sutil */
            height: 50px; /* Altura fija para celdas de selección, asegurando el mismo tamaño */
            box-sizing: border-box; /* Incluir padding y borde en la altura */
            -webkit-appearance: none; /* Eliminar estilo por defecto en Safari/Chrome */
            -moz-appearance: none; /* Eliminar estilo por defecto en Firefox */
            appearance: none; /* Eliminar estilo por defecto */
            /* Flecha SVG para selects, con color adaptable */
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="%2300FFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
        }

        input[type="text"]::placeholder,
        input[type="tel"]::placeholder {
            color: #B0B0B0; /* Placeholder más claro */
        }

        input[type="text"]:focus,
        input[type="tel"]:focus,
        select:focus {
            outline: none;
            border-color: #00FF00; /* Borde verde neón al enfocar */
            box-shadow: 0 0 0 4px rgba(0, 255, 0, 0.6), inset 0 0 10px rgba(0, 255, 0, 0.4); /* Resplandor más fuerte */
        }

        /* Estilos para el selector de artículos */
        #amountButtons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); /* Artículos más grandes */
            gap: 25px; /* Más espacio entre artículos */
            justify-content: center;
        }
        .amount-item {
            background-color: rgba(30, 0, 60, 0.7); /* Fondo más claro */
            border: 2px solid #8A2BE2; /* Borde morado */
            border-radius: 15px; /* Más redondeado */
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.6); /* Sombra más pronunciada */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px; /* Más padding */
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 180px; /* Altura mínima uniforme */
            text-align: center;
            box-sizing: border-box;
            position: relative; /* Para el efecto de brillo */
            overflow: hidden; /* Ocultar el brillo que se desborda */
        }
        .amount-item::before { /* Efecto de brillo al pasar el ratón */
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.15) 0%, transparent 80%);
            transform: rotate(45deg);
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            opacity: 0;
        }
        .amount-item:hover::before {
            transform: rotate(45deg) translate(20%, 20%);
            opacity: 1;
        }
        .amount-item:hover:not(.selected) {
            background-color: rgba(138, 43, 226, 0.8); /* Morado más brillante */
            box-shadow: 0 8px 25px rgba(138, 43, 226, 1), 0 0 30px rgba(0, 255, 255, 0.5); /* Doble resplandor */
            transform: translateY(-8px); /* Efecto de elevación más notable */
        }
        .amount-item.selected {
            background: linear-gradient(to right, #00E676, #00FFFF); /* Degradado verde-cian intenso */
            border-color: #00FFFF;
            color: #1A052E; /* Texto oscuro */
            box-shadow: 0 0 30px rgba(0, 255, 255, 1), 0 0 40px rgba(0, 230, 118, 1); /* Resplandor muy brillante */
            transform: scale(1.08); /* Efecto de escala más pronunciado */
        }
        .item-image {
            width: 100px; /* Imágenes más grandes */
            height: 100px;
            object-fit: contain;
            margin-bottom: 12px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4); /* Pequeño resplandor en la imagen */
        }
        .item-label {
            color: #FFFFFF; /* Texto blanco predeterminado */
            font-weight: bold;
            font-size: 1.2em; /* Texto más grande */
            line-height: 1.3;
        }
        .amount-item.selected .item-label {
            color: #1A052E; /* Texto oscuro cuando está seleccionado */
        }


        #priceSummary, #messageDisplay, #paymentMethodsDisplay {
            padding: 25px; /* Más padding */
            border-radius: 15px; /* Más redondeado */
            margin-top: 30px; /* Más margen superior */
            text-align: center;
            background-color: rgba(30, 0, 60, 0.9); /* Fondo oscuro translúcido, consistente */
            border: 2px solid #8A2BE2; /* Borde morado neón */
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5); /* Sombra más fuerte */
        }
        #priceSummary p, #paymentMethodsList p {
            color: #E0F7FA; /* Texto claro para legibilidad */
        }

        #totalPriceDisplay {
            font-weight: bold;
            color: #00FFFF; /* Cian neón */
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8); /* Resplandor al total */
            font-size: 1.8em; /* Total más grande */
        }
        #currencySymbolDisplay {
            color: #00FF00; /* Verde neón para el símbolo de moneda */
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.8);
        }
        #baseAmountDisplay {
            color: #A9A9A9; /* Gris más claro para el monto base */
            font-size: 1em;
        }
        #paymentMethodsList p span {
            color: #00E676; /* Verde neón para los nombres de los métodos */
            font-weight: bold;
        }

        /* Visualización de mensajes */
        #messageDisplay {
            font-weight: bold;
            padding: 20px;
            border-radius: 10px;
            text-shadow: 0 0 5px rgba(0,0,0,0.2);
            color: white;
            font-size: 1.1em;
        }
        .message-error {
            background-color: #A30000; /* Rojo oscuro vibrante */
            border: 2px solid #FF5555;
            color: #FFDDDD; /* Texto rojo muy claro */
        }
        .message-success {
            background-color: #007A00; /* Verde oscuro vibrante */
            border: 2px solid #00FF00;
            color: #DDFFDD; /* Texto verde muy claro */
        }
        .message-info {
            background-color: #0000A3; /* Azul oscuro vibrante */
            border: 2px solid #5555FF;
            color: #DDEEFF; /* Texto azul muy claro */
        }
        /* Advertencia de transferencia */
        .transfer-warning {
            background-color: #E25822; /* Naranja más oscuro */
            border: 3px solid #FFD700; /* Borde amarillo brillante más grueso */
            color: #2A0000; /* Texto oscuro para alto contraste */
            font-weight: bold;
            padding: 22px; /* Más padding */
            border-radius: 15px; /* Más redondeado */
            margin-top: 30px; /* Más margen superior */
            text-align: center;
            box-shadow: 0 0 25px rgba(255, 100, 50, 0.9), 0 0 40px rgba(255, 215, 0, 0.9); /* Doble resplandor neón */
            animation: pulse-warning 1.8s infinite alternate; /* Animación de pulsación más lenta */
        }

        /* Estilos de botones de acción */
        .action-button { 
            background: linear-gradient(to right, #00e676, #00c853); /* Degradado verde neón */
            color: #0d001a; /* Texto muy oscuro en el botón neón */
            padding: 15px 20px; /* Más padding para mayor tamaño */
            border: none;
            border-radius: 10px; /* Más redondeado */
            cursor: pointer;
            font-size: 1.2em; /* Texto más grande */
            font-weight: bold;
            display: block; /* Asegura que ocupe su propia línea y se pueda centrar */
            max-width: 450px; /* Ancho máximo para el botón */
            margin: 20px auto 0 auto; /* Centrar horizontalmente y añadir margen superior */
            box-shadow: 0 5px 20px rgba(0, 230, 118, 0.7); /* Sombra con resplandor verde neón */
            transition: all 0.3s ease;
        }

        .action-button:hover:not(:disabled) { /* Hover solo si no está deshabilitado */
            background: linear-gradient(to right, #00c853, #00ffff); /* Verde a cian neón al pasar el ratón */
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.8); /* Resplandor cian al pasar el ratón */
            transform: translateY(-3px) scale(1.01); /* Efecto 3D sutil */
        }

        .action-button:disabled { /* Estilo para botones deshabilitados */
            background: linear-gradient(to right, #505050, #707070); /* Degradado gris sutil */
            color: #A0A0A0; /* Texto gris claro */
            cursor: not-allowed;
            opacity: 0.8; /* Menos opacidad para indicar inactividad */
            box-shadow: 0 2px 10px rgba(0,0,0,0.4); /* Sombra sutil para profundidad */
            transform: none; /* Eliminar transform en disabled */
        }

        /* Estilo específico para el botón de confirmar transferencia */
        #confirmTransferBtn {
            background: linear-gradient(to right, #FF00FF, #8a2be2); /* Degradado magenta-morado neón */
            box-shadow: 0 5px 20px rgba(255, 0, 255, 0.7); /* Sombra con resplandor magenta neón */
        }
        #confirmTransferBtn:hover:not(:disabled) {
            background: linear-gradient(to right, #8a2be2, #FF00FF); /* Degradado invertido */
            box-shadow: 0 8px 25px rgba(255, 0, 255, 0.8); /* Resplandor más fuerte */
        }


        /* Estilos del modal (advertencia WhatsApp) */
        #whatsappWarningModal > div {
            background-color: rgba(20, 0, 50, 0.98); /* Fondo oscuro casi opaco */
            border: 3px solid #00FFFF; /* Borde cian neón más grueso */
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.8); /* Sombra con resplandor cian más fuerte */
            color: #E0F7FA; /* Texto principal claro */
            padding: 30px;
            border-radius: 15px;
        }
        #whatsappWarningModal h2 {
            color: #00FFFF; /* Cian neón */
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            font-size: 1.8em;
        }
        #whatsappWarningModal p {
            color: #E0F7FA;
            font-size: 1.1em;
        }
        #whatsappWarningModal p span {
            color: #FF00FF; /* Magenta neón */
            text-shadow: 0 0 8px rgba(255, 0, 255, 0.7);
        }
        #whatsappWarningModal #cancelWhatsApp,
        #whatsappWarningModal #confirmWhatsApp {
            padding: 12px 25px; /* Botones más grandes */
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1em;
            margin: 10px;
        }
        #whatsappWarningModal #cancelWhatsApp {
            background-color: #555555;
            color: #E0F7FA;
            border: 1px solid #777777;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
        }
        #whatsappWarningModal #cancelWhatsApp:hover {
            background-color: #777777;
            box-shadow: 0 5px 12px rgba(0,0,0,0.6);
        }
        #whatsappWarningModal #confirmWhatsApp {
            background: linear-gradient(to right, #00E676, #00FFFF);
            color: #1A052E;
            box-shadow: 0 5px 18px rgba(0, 255, 255, 0.8);
        }
        #whatsappWarningModal #confirmWhatsApp:hover {
            background: linear-gradient(to right, #00FFFF, #00E676);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 1);
        }

        /* Estilos para la animación de carga */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            animation: pulse-text 1.5s infinite alternate; /* Animación de pulsación para el texto de carga */
        }
        @keyframes pulse-text {
            0% { opacity: 0.7; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.05); }
        }

        /* Media Queries para Responsive Design */
        @media (max-width: 768px) {
            .app-header {
                padding: 10px 0;
            }
            .dharck-store-title {
                font-size: 2.2em; /* Reducir tamaño del título en móvil */
                margin-right: 15px;
            }
            .title-logo {
                height: 50px; /* Reducir tamaño del logo en móvil */
            }
            .form-container {
                padding: 20px;
                border-radius: 15px;
                margin-top: 20px; /* Ajustar margen */
            }
            .amount-item {
                min-height: 140px;
                padding: 15px;
            }
            .item-image {
                width: 70px;
                height: 70px;
            }
            .item-label {
                font-size: 1em;
            }
            label {
                font-size: 1.1em;
            }
            input[type="text"], input[type="tel"], select {
                padding: 10px;
                font-size: 1em;
                height: 45px; /* Ajustar altura para móvil */
            }
            .action-button {
                padding: 12px 15px;
                font-size: 1.1em;
                max-width: 90%; /* Ajustar ancho máximo para móvil */
            }
            #whatsappWarningModal > div {
                max-width: 90%;
            }
        }

        @media (max-width: 480px) {
            .app-header {
                padding: 8px 0;
            }
            .dharck-store-title {
                font-size: 1.8em;
                margin-right: 10px;
            }
            .title-logo {
                height: 40px;
            }
            .amount-item {
                min-height: 120px;
            }
            .item-image {
                width: 60px;
                height: 60px;
            }
            .form-container {
                padding: 15px;
                margin-top: 15px; /* Ajustar margen */
            }
        }

    </style>

    <!-- La ruta /logo.png asume que 'logo.png' está directamente en la carpeta 'public/' de tu proyecto de Vercel. -->
    <img src="/logo.png" alt="DHARCK STORE Logo Background" class="background-logo">

    <!-- Header para el título de la aplicación -->
    <header class="app-header">
        <div class="dharck-store-title-container">
            <h1 class="dharck-store-title">
                DHARCK STORE
            </h1>
            <!-- La ruta /logo.png asume que 'logo.png' está directamente en la carpeta 'public/' de tu proyecto de Vercel. -->
            <img src="/logo.png" alt="Logotipo de la TIENDA DHARCK" class="title-logo">    
        </div>
    </header>

    <div class="form-container">
        <form id="topupForm">
            <div class="form-group">
                <label for="game">
                    SELECCIONA EL JUEGO:
                </label>
                <select
                    id="game"
                    name="game"
                    required
                >
                    <option value="">-- ELIGE EL JUEGO --</option>
                    </select>
            </div>

            <div id="amountSelection" class="form-group" style="display: none;">
                <label>
                    SELECCIONA EL ARTICULO:
                </label>
                <div id="amountButtons">
                    <!-- Los divs de los artículos se generarán aquí con JS -->
                </div>
            </div>

            <div class="form-group">
                <label for="userId">
                    ID DEL JUGADOR:
                </label>
                <input
                    type="tel"
                    id="userId"
                    name="userId"
                    placeholder="Ej: 1234567890"
                    pattern="[0-9]*"
                    title="Por favor, ingresa solo números."
                    required
                />
            </div>
            <div class="form-group">
                <label for="userName">
                    NOMBRE DEL JUGADOR:
                </label>
                <input
                    type="text"
                    id="userName"
                    name="userName"
                    placeholder="Ej: ElCojeViejas300"
                    required
                />
            </div>

            <div class="form-group">
                <label for="seller">
                    SELECCIONA EL VENDEDOR:
                </label>
                <select
                    id="seller"
                    name="seller"
                    required
                >
                    <option value="">-- ELIGE UN VENDEDOR --</option>
                </select>
            </div>

            <div class="form-group">
                <label for="country">
                    SELECCIONA TU PAIS:
                </label>
                <select
                    id="country"
                    name="country"
                    required
                >
                    <option value="">-- Elige un país --</option>
                    </select>
            </div>
            <input type="hidden" id="gameHidden" name="game">
            <input type="hidden" id="amountUSDHidden" name="amountUSD">
            <input type="hidden" id="totalPriceHidden" name="totalPrice">
            <input type="hidden" id="currencySymbolHidden" name="currencySymbol">


            <div id="priceSummary" style="display: none;">
                <p>RESUMEN DE PEDIDO:</p>
                <p>
                    TOTAL A PAGAR: <span id="totalPriceDisplay"></span> <span id="currencySymbolDisplay"></span>
                </p>
                <p>
                    (BASADO EN <span id="baseAmountDisplay"></span> USD + COMISION!)
                </p>
            </div>

            <div id="paymentMethodsDisplay" style="display: none;">
                <p>METODOS DE PAGOS:</p>
                <div id="paymentMethodsList"></div>
            </div>

            <div id="transferWarningMessage" class="transfer-warning">
                ¡Advertencia! No oprimas el botón de "Confirmar Transferencia" si aún no has realizado el pago. Recuerda guardar una imagen del comprobante de pago. La entrega puede demorar entre 5 minutos a 1 hora en reflejarse en el juego
            </div>

            <button
                type="button"
                id="confirmTransferBtn"
                class="action-button"
                disabled="true"
            >
                ¡CONFIRMAR QUE HAZ PAGADO! 
            </button>

            <button
                type="submit"
                id="sendWhatsAppOrderBtn"
                class="action-button"
                style="display: none;"
            >
                ENVIAR EL PEDIDO
            </button>

            <div id="messageDisplay" style="display: none;"></div>
        </form>
    </div>

    <div id="whatsappWarningModal" style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 1000; display: none;">
        <div style="background-color: rgba(10, 0, 30, 0.95); padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 400px; width: 100%; text-align: center;">
            <h2>¡Importante!</h2>
            <p style="color: #e0f2fe;">
                Tu pedido será enviado por WhatsApp.
                <span style="color: #ff00ff;">Recuerda enviar el comprobante de pago por WhatsApp después de confirmar el pedido.</span>
            </p>
            <div>
                <button id="cancelWhatsApp" type="button">
                    Cancelar
                </button>
                <button id="confirmWhatsApp" type="button">
                    Confirmar y Enviar
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay (NUEVO) -->
    <div id="loadingOverlay" style="position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); z-index: 1001; color: white; display: none;">
        <div class="spinner" style="border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #00ffff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;"></div>
        <p style="margin-top: 15px; font-size: 1.2em; color: #00ffff; text-shadow: 0 0 8px rgba(0, 255, 255, 0.6);" class="loading-text">Cargando...</p>
    </div>

    <script type="module">

        // Número de WhatsApp Business predeterminado (fallback si no se encuentra el vendedor)
        const DEFAULT_WHATSAPP_NUMBER = '584126027407'; 

        // Elementos ocultos (ahora solo para datos del formulario)
        const gameHidden = document.getElementById('gameHidden');
        const amountUSDHidden = document.getElementById('amountUSDHidden');
        const totalPriceHidden = document.getElementById('totalPriceHidden');
        const currencySymbolHidden = document.getElementById('currencySymbolHidden');

        // Referencias al modal
        const whatsappWarningModal = document.getElementById('whatsappWarningModal');
        const confirmWhatsAppBtn = document.getElementById('confirmWhatsApp');
        const cancelWhatsAppBtn = document.getElementById('cancelWhatsApp');

        // Nuevos botones de acción
        const confirmTransferBtn = document.getElementById('confirmTransferBtn');
        const sendWhatsAppOrderBtn = document.getElementById('sendWhatsAppOrderBtn');
        const loadingOverlay = document.getElementById('loadingOverlay'); // Referencia al overlay de carga

        // Datos de juegos y sus precios base en USD
        // ¡IMPORTANTE! Asegúrate de que tus imágenes de artículos sean optimizadas y de tamaño adecuado (ej. 80x80px comprimidas a WebP o PNG ligero).
        const gameOptions = [
            { name: 'LORDS MOBILE', amounts: [
                // Las rutas '/image/nombre-de-archivo.png' asumen que las imágenes están en la carpeta 'public/image/' en tu proyecto de Vercel.
                // Asegúrate de que los nombres de los archivos (incluyendo mayúsculas/minúsculas y extensión) coincidan exactamente.
                { value: 2.30, label: 'PASE SEMANAL', imageUrl: '/image/7day.png' },
                { value: 19.90, label: 'PASE MENSUAL', imageUrl: '/image/30day.png' },
                { value: 2.30, label: '209💎', imageUrl: '/image/prize-2.png' },
                { value: 5.20, label: '524💎', imageUrl: '/image/prize-3.png' },
                { value: 10.00, label: '1048💎', imageUrl: '/image/prize-4.png' },
                { value: 19.50, label: '2096💎', imageUrl: '/image/prize-5.png' },
                { value: 29.00, label: '3144💎', imageUrl: '/image/prize-6.png' },
                { value: 48.00, label: '5240💎', imageUrl: '/image/prize-6.png' },
                { value: 62.00, label: '6812💎', imageUrl: '/image/prize-6.png' },
                { value: 92.00, label: '9956💎', imageUrl: '/image/prize-7.png' },
                { value: 178.00, label: '19912💎', imageUrl: '/image/prize-7.png' },
                { value: 270.00, label: '30392💎', imageUrl: '/image/prize-7.png' },
                { value: 440.00, label: '50304💎', imageUrl: '/image/icon-happy.png' },
            ] },
//            { name: 'LORDS MOBILE PROMOCION', amounts: [
//                { value: 5.20, label: '💎499+', imageUrl: '/image/prize-2.png' },
//                { value: 12.00, label: '💎999+', imageUrl: '/image/prize-3.png' },
//                { value: 20.00, label: '💎1999+', imageUrl: '/image/prize-4.png' },
//                { value: 25.50, label: '💎2499+', imageUrl: '/image/prize-5.png' },
//                { value: 30.00, label: '💎2999+', imageUrl: '/image/prize-6.png' },
//                { value: 48.50, label: '💎4999+', imageUrl: '/image/prize-7.png' },
//                { value: 94.00, label: '💎9999+', imageUrl: '/image/icon-happy.png' },
//            ] },
            
            { name: 'BLOOD STRIKE', amounts: [
                { value: 0.89, label: '100+5🧈', imageUrl: '/image/100.png' },
                { value: 2.50, label: '300+20🧈', imageUrl: '/image/300.png' },
                { value: 4.30, label: '500+40🧈', imageUrl: '/image/500.png' },
                { value: 8.50, label: '1000+100🧈', imageUrl: '/image/1000.png' },
                { value: 17.60, label: '2000+200🧈', imageUrl: '/image/2000.png' },
                { value: 42.00, label: '5000+800🧈', imageUrl: '/image/5000.png' },
                { value: 3.50, label: 'PASE ELITE🧈', imageUrl: '/image/elite.png' },
                { value: 8.51, label: 'PASE PREMIUM🧈', imageUrl: '/image/premium.png' },
                { value: 2.00, label: 'PASE DE NIVEL🧈', imageUrl: '/image/mejora.png' },
            ] },
             { name: 'FREE FIRE', amounts: [
                { value: 1.80, label: '💎SEMANAL', imageUrl: '/image/ffs.png' },
                { value: 8.50, label: '💎MENSUAL', imageUrl: '/image/ffm.png' },
                { value: 0.99, label: '💎100+10', imageUrl: '/image/prize-2.png' },
                { value: 1.90, label: '💎200+20', imageUrl: '/image/prize-3.png' },
                { value: 2.80, label: '💎310+31', imageUrl: '/image/prize-4.png' },
                { value: 4.60, label: '💎520+52', imageUrl: '/image/prize-5.png' },
                { value: 9.50, label: '💎1069+106', imageUrl: '/image/prize-6.png' },
                { value: 18.00, label: '💎2180+218', imageUrl: '/image/prize-7.png' },
                { value: 40.00, label: '💎5600+560', imageUrl: '/image/prize-7.png' },
            ] },

            { name: 'GENSHIN IMPACT', amounts: [
                { value: 4.8, label: 'PASE LUNAR', imageUrl: '/image/bl.png' },
                { value: 0.90, label: '60', imageUrl: '/image/cg1.png' },
                { value: 4.70, label: '300+30', imageUrl: '/image/cg2.png' },
                { value: 13.00, label: '980+110', imageUrl: '/image/cg3.png' },
                { value: 27.00, label: '1980+260', imageUrl: '/image/cg4.png' },
                { value: 45.50, label: '3280+600', imageUrl: '/image/cg5.png' },
                { value: 90.00, label: '6480+1600', imageUrl: '/image/cg6.png' },
            ] },

            { name: 'PUBG MOBILE', amounts: [
                { value: 0.99, label: '60', imageUrl: '/image/pm.png' },
                { value: 4.85, label: '300+25', imageUrl: '/image/pm.png' },
                { value: 9.00, label: '600+60', imageUrl: '/image/pm.png' },
                { value: 23.00, label: '1500+300', imageUrl: '/image/pm.png' },
                { value: 45.00, label: '3000+850', imageUrl: '/image/pm.png' },
                { value: 92.00, label: '6000+2100', imageUrl: '/image/pm.png' },
            ] },

             { name: 'DELTA FORCE STEAM', amounts: [
                { value: 0.99, label: '60 Coins', imageUrl: '/image/dfs1.png' },
                { value: 4.70, label: '300+20 Coins', imageUrl: '/image/dfs1.png' },
                { value: 6.80, label: '420+40 Coins', imageUrl: '/image/pdfs2.png' },
                { value: 9.00, label: '680+70 Coins', imageUrl: '/image/dfs2.png' },
                { value: 17.00, label: '1280+200 Coins', imageUrl: '/image/dfs3.png' },
                { value: 21.00, label: '1680+300 Coins', imageUrl: '/image/dfs3.png' },
                { value: 40.00, label: '3280+670 Coins', imageUrl: '/image/dfs4.png' },
                { value: 80.00, label: '6480+1620 Coins', imageUrl: '/image/dfs4.png' },
                { value: 174.00, label: '12960+3240 Coins', imageUrl: '/image/dfs5.png' },
                { value: 260.00, label: '19440+4860 Coins', imageUrl: '/image/dfs5.png' },
                     ] },
            // Puedes añadir más juegos aquí
        ];

        // Datos de países y tasas de cambio (AHORA HARDCODEADOS DIRECTAMENTE EN EL FRONTEND)
        let countryData = [
            {
                name: 'VENEZUELA',
                code: 'VES',
                exchangeRate: 141, // Tasa de cambio directa
                symbol: 'Bs.',
                paymentMethods: [
                    { name: 'Pago Móvil', details: 'C.I.: V-32147818, Teléfono: 04126027407, Banco: 0105 (Banco Mercantil)' },
                    { name: '¡IMPORTANTE!', details: '¡No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'COLOMBIA',
                code: 'COP',
                exchangeRate: 4300,
                symbol: 'COP',
                paymentMethods: [
                    { name: 'Nequi', details: 'Número: 3012660676 Nombre:Ali.' },
                    { name: '¡IMPORTANTE!', details: '¡No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'PERU',
                code: 'PEN',
                exchangeRate: 3.9,
                symbol: 'S/.',
                paymentMethods: [
                    { name: 'BCP', details: 'Cuenta: 38097062947042, Titular: Yoshimara' },
                    { name: 'Yape', details: 'Número: 974610375' },
                    { name: '¡IMPORTANTE!', details: '¡No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'MEXICO',
                code: 'MXN',
                exchangeRate: 20.1,
                symbol: 'MXN',
                paymentMethods: [
                    { name: 'SPIN BY OXXO', details: 'TARJETA: 4217 4701 8364 0099' },
                    { name: 'BANCO AZTECA', details: 'INTERBANCARIA: 1277 9700 1467 5859 00' },
                    { name: 'Titular', details: 'Jesus Carrillo' },
                    { name: '¡IMPORTANTE!', details: '¡No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'ESTADOS UNIDOS',
                code: 'USD',
                exchangeRate: 1.05, 
                symbol: '$',
                paymentMethods: [
                    { name: 'Zelle', details: '+1 (661) 736 - 0564, Nombre: Jannett Martinez Lopez' },
                    { name: 'Titular', details: 'Jannett Martinez Lopez' },
                    { name: '¡IMPORTANTE!', details: '¡No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'ARGENTINA',
                code: 'ARS',
                exchangeRate: 1270,
                symbol: '$',
                paymentMethods: [
                    { name: 'Mercado pago', details: '0000003100069089540216' },
                    { name: 'UALA', details: '3840200500000000199867' },
                    { name: 'Titular', details: 'Pamela Schneider' },
                    { name: '¡IMPORTANTE!', details: '¡No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'ECUADOR',
                code: 'USD',
                exchangeRate: 1.06,
                symbol: '$',
                paymentMethods: [
                    { name: 'Banco Pichincha', details: 'Cta. ahorros 2204277346' },
                    { name: 'Banco de Guayaquil', details: 'Cta. ahorros 0039924590' },
                    { name: 'Titular', details: 'María de los Ángeles Ronquillo León. CI: 0941414203' },
                    { name: '¡IMPORTANTE!', details: '¡No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'CHILE',
                code: 'CLP',
                exchangeRate: 1010,
                symbol: '$',
                paymentMethods: [
                    { name: 'BANCO FALABELLA', details: 'RUT: 17244216-1 / gi553ll30@gmail.com / Cta Corriente: 1-983-036407-8' },
                    { name: 'BANCO ESTADO', "details": 'RUT: 17244216-1 / Cta Corriente: 37100135052 / 300 PESOS EXTRAS AL VALOR TOTAL'},
                    { name: 'Titular', "details": 'GISSELLE GONZALEZ'},
                    { name: '¡IMPORTANTE!', "details": '¡No colocar conceptos EN LOS PAGOS!'},
                ]
            },
            {
                name: 'ESPAÑA',
                code: 'EUR',
                exchangeRate: 1.03,
                symbol: '€',
                paymentMethods: [
                    { name: 'BIZUM', details: '612237372 / 614153840 / CUALQUIERA DE LOS DOS' },
                    { name: 'BANCO SANTANDER', details: 'Cuenta bancaria : ES0800495939582916425258' },
                    { name: 'Titular', details: 'MAX FRANCIS SILVA RAMOS' },
                    { name: '¡IMPORTANTE!', details: '¡No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            { 
                name: 'COSTA RICA',
                code: 'CRC',
                exchangeRate: 600,
                symbol: '₡',
                paymentMethods: [
                    { name: 'SIMPE', details: '63223852' },
                    { name: 'Titular', details: 'Solange Granja Duarte' },
                    { name: '¡IMPORTANTE!', details: '¡No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            { 
                name: 'BOLIVIA',
                code: 'BOB',
                exchangeRate: 16.9,
                symbol: 'Bs.', 
                paymentMethods: [
                    { name: 'SIMPE', details: '63223852' }, 
                    { name: 'Titular', details: 'Solange Granja Duarte'}, 
                    { name: '¡IMPORTANTE!', details: '¡No colocar conceptos EN LOS PAGOS!' },
                ]
            },
        ];

        // Datos de vendedores (ACTUALIZADOS)
        const sellerData = [
            { name: 'XJoseDharckX', phoneNumber: '584126027407' },
            { name: 'Miguel', phoneNumber: '5214951219766' }, 
            { name: 'Alfredo Favier', phoneNumber: '5353148505' }, 
            { name: 'Candy Candy', phoneNumber: '584144274483' }, 
            { name: 'Satoru', phoneNumber: '5491170897494' }, 
            { name: 'Ernesto', phoneNumber: '573025129990' }, 
            { name: 'OSCAR', phoneNumber: '573002030533' },
            // Puedes añadir más vendedores aquí si es necesario
        ];

        let selectedGame = '';
        let selectedAmountUSD = 0;
        let selectedCountry = '';
        let selectedSeller = ''; 
        let totalPrice = 0;
        let currencySymbol = 'USD';

        // Elementos del DOM
        const gameSelect = document.getElementById('game');
        const amountSelectionDiv = document.getElementById('amountSelection');
        const amountButtonsDiv = document.getElementById('amountButtons');
        const userIdInput = document.getElementById('userId');
        const userNameInput = document.getElementById('userName');
        const sellerSelect = document.getElementById('seller'); 
        const countrySelect = document.getElementById('country');
        const priceSummaryDiv = document.getElementById('priceSummary');
        const totalPriceDisplay = document.getElementById('totalPriceDisplay');
        const currencySymbolDisplay = document.getElementById('currencySymbolDisplay');
        const baseAmountDisplay = document.getElementById('baseAmountDisplay');
        const messageDisplay = document.getElementById('messageDisplay');
        const topupForm = document.getElementById('topupForm');
        const paymentMethodsDisplayDiv = document.getElementById('paymentMethodsDisplay');
        const paymentMethodsListDiv = document.getElementById('paymentMethodsList');
        const transferWarningMessage = document.getElementById('transferWarningMessage');


        // Función para validar todos los campos y habilitar/deshabilitar el botón de Confirmar Transferencia
        function updateConfirmTransferButtonState() {
            const isGameSelected = gameSelect.value !== '';
            const isAmountSelected = selectedAmountUSD > 0;
            const isUserIdFilled = userIdInput.value.trim() !== '';
            const isUserNameFilled = userNameInput.value.trim() !== '';
            const isSellerSelected = sellerSelect.value !== ''; 
            const isCountrySelected = countrySelect.value !== '';

            // Validar si el ID de usuario contiene solo números
            const userIdPattern = /^[0-9]*$/;
            const isUserIdNumeric = userIdPattern.test(userIdInput.value.trim());

            if (isGameSelected && isAmountSelected && isUserIdFilled && isUserNameFilled && isSellerSelected && isCountrySelected && isUserIdNumeric) {
                confirmTransferBtn.disabled = false;
                messageDisplay.style.display = 'none'; 
            } else {
                confirmTransferBtn.disabled = true;
                if (!messageDisplay.textContent || messageDisplay.style.display === 'none') {
                    if (!isUserIdNumeric && isUserIdFilled) {
                        showMessage('El ID de Usuario solo debe contener números.', 'error');
                    } else if (isUserIdFilled && isUserNameFilled && isCountrySelected && isGameSelected && isAmountSelected && isSellerSelected && !isUserIdNumeric) {
                        // This case is already covered by the specific check above
                    } else {
                        const currentMessageType = messageDisplay.classList.contains('message-error') ? 'error' : messageDisplay.classList.contains('message-info') ? 'info' : '';
                        if (!currentMessageType) { 
                            showMessage('Por favor, completa todos los campos para confirmar la transferencia.', 'info');
                        }
                    }
                }
            }
        }


        // Función para cargar opciones de juego
        function loadGameOptions() {
            gameOptions.forEach(game => {
                const option = document.createElement('option');
                option.value = game.name;
                option.textContent = game.name;
                gameSelect.appendChild(option);
            });
        }

        // Función para cargar opciones de país
        function loadCountryOptions() {
            // Limpiar opciones existentes primero
            countrySelect.innerHTML = '<option value="">-- ELIGE TU PAIS --</option>';
            countryData.forEach(country => {
                const option = document.createElement('option');
                option.value = country.name;
                option.textContent = country.name;
                countrySelect.appendChild(option);
            });
        }

        // Función para cargar opciones de vendedor
        function loadSellerOptions() {
            sellerData.forEach(seller => {
                const option = document.createElement('option');
                option.value = seller.name; 
                option.textContent = seller.name;
                sellerSelect.appendChild(option);
            });
        }

        // Manejador de cambio de juego
        gameSelect.addEventListener('change', (e) => {
            selectedGame = e.target.value;
            selectedAmountUSD = 0; 
            updateAmountSelection();
            updatePriceSummary();
            sendWhatsAppOrderBtn.style.display = 'none';
            messageDisplay.style.display = 'none'; 
            transferWarningMessage.style.display = 'block'; 
            updateConfirmTransferButtonState();
        });

        // Función para actualizar los botones de monto con imágenes
        function updateAmountSelection() {
            amountButtonsDiv.innerHTML = ''; 
            if (selectedGame) {
                amountSelectionDiv.style.display = 'block'; 
                const currentAmounts = gameOptions.find(g => g.name === selectedGame)?.amounts;
                currentAmounts.forEach(amount => {
                    const itemDiv = document.createElement('div'); 
                    itemDiv.classList.add('amount-item'); 
                    itemDiv.dataset.value = amount.value; 

                    const imgElement = document.createElement('img');
                    imgElement.src = amount.imageUrl;
                    imgElement.alt = amount.label;
                    imgElement.classList.add('item-image');
                    imgElement.width = 80;
                    imgElement.height = 80;
                    imgElement.loading = 'lazy';
                    
                    // Añade un manejador de error para depuración
                    imgElement.onerror = function() {
                        this.onerror = null; // Previene bucles infinitos si el fallback también falla
                        this.src = 'https://placehold.co/80x80/cccccc/000000?text=Error'; // Placeholder
                        console.error('Failed to load image:', amount.imageUrl); // Log en la consola
                    };

                    // Mensaje de depuración para la URL de la imagen
                    console.log('Attempting to load image:', amount.imageUrl); 

                    const labelSpan = document.createElement('span');
                    labelSpan.classList.add('item-label');
                    labelSpan.textContent = amount.label;

                    itemDiv.appendChild(imgElement);
                    itemDiv.appendChild(labelSpan);

                    itemDiv.addEventListener('click', () => {
                        selectedAmountUSD = parseFloat(amount.value);
                        Array.from(amountButtonsDiv.children).forEach(div => div.classList.remove('selected'));
                        itemDiv.classList.add('selected');
                        updatePriceSummary();
                        sendWhatsAppOrderBtn.style.display = 'none';
                        messageDisplay.style.display = 'none'; 
                        transferWarningMessage.style.display = 'block'; 
                        updateConfirmTransferButtonState();
                    });
                    amountButtonsDiv.appendChild(itemDiv);
                });
            } else {
                amountSelectionDiv.style.display = 'none'; 
            }
        }

        // Manejador de cambio de vendedor (NUEVO)
        sellerSelect.addEventListener('change', (e) => {
            selectedSeller = e.target.value;
            sendWhatsAppOrderBtn.style.display = 'none';
            messageDisplay.style.display = 'none'; 
            transferWarningMessage.style.display = 'block'; 
            updateConfirmTransferButtonState();
        });

        // Manejador de cambio de país
        countrySelect.addEventListener('change', (e) => {
            selectedCountry = e.target.value;
            updatePriceSummary();
            sendWhatsAppOrderBtn.style.display = 'none';
            messageDisplay.style.display = 'none'; 
            transferWarningMessage.style.display = 'block'; 
            updateConfirmTransferButtonState();
        });
        
        // Manejadores de input para validar y restablecer botones
        userIdInput.addEventListener('input', () => {
            sendWhatsAppOrderBtn.style.display = 'none';
            messageDisplay.style.display = 'none'; 
            transferWarningMessage.style.display = 'block'; 
            updateConfirmTransferButtonState();
        });

        userNameInput.addEventListener('input', () => {
            sendWhatsAppOrderBtn.style.display = 'none';
            messageDisplay.style.display = 'none'; 
            transferWarningMessage.style.display = 'block'; 
            updateConfirmTransferButtonState();
        });


        // Función para actualizar el resumen del precio y los métodos de pago
        function updatePriceSummary() {
            if (selectedAmountUSD > 0 && selectedCountry) {
                const countryInfo = countryData.find(country => country.name === selectedCountry);
                if (countryInfo) {
                    totalPrice = selectedAmountUSD * countryInfo.exchangeRate;
                    currencySymbol = countryInfo.symbol;
                    totalPriceDisplay.textContent = totalPrice.toFixed(2);
                    currencySymbolDisplay.textContent = currencySymbol;
                    baseAmountDisplay.textContent = selectedAmountUSD.toFixed(2);
                    priceSummaryDiv.style.display = 'block'; 

                    // Mostrar métodos de pago para el país seleccionado
                    paymentMethodsListDiv.innerHTML = '';
                    if (countryInfo.paymentMethods && countryInfo.paymentMethods.length > 0) {
                        countryInfo.paymentMethods.forEach(method => {
                            const p = document.createElement('p');
                            p.innerHTML = `<span>${method.name}:</span> ${method.details}`;
                            paymentMethodsListDiv.appendChild(p);
                        });
                        paymentMethodsDisplayDiv.style.display = 'block'; 
                    } else {
                        paymentMethodsDisplayDiv.style.display = 'none'; 
                    }

                }
            } else {
                priceSummaryDiv.style.display = 'none'; 
                paymentMethodsDisplayDiv.style.display = 'none'; 
            }
        }

        // Función para mostrar mensajes al usuario
        function showMessage(msg, type) {
            messageDisplay.textContent = msg;
            messageDisplay.style.display = 'block'; 
            messageDisplay.classList.remove('message-error', 'message-success', 'message-info'); 

            if (type === 'error') {
                messageDisplay.classList.add('message-error');
            } else if (type === 'success') {
                messageDisplay.classList.add('message-success');
            } else if (type === 'info') {
                messageDisplay.classList.add('message-info');
            }
        }

        // Función para mostrar el modal de advertencia de WhatsApp
        function showWhatsAppWarningModal() {
            whatsappWarningModal.style.display = 'flex'; 
            messageDisplay.style.display = 'none'; 
        }

        // Función para ocultar el modal de advertencia de WhatsApp
        function hideWhatsAppWarningModal() {
            whatsappWarningModal.style.display = 'none'; 
        }

        // Manejador del botón "Confirmar Transferencia"
        confirmTransferBtn.addEventListener('click', () => {
            if (confirmTransferBtn.disabled) {
                return;
            }

            if (!gameSelect.value) { showMessage('Por favor, selecciona un juego.', 'error'); return; }
            if (selectedAmountUSD <= 0) { showMessage('Por favor, selecciona un monto.', 'error'); return; }
            if (!userIdInput.value.trim()) { showMessage('Por favor, ingresa tu ID de Usuario.', 'error'); return; }
            if (!userNameInput.value.trim()) { showMessage('Por favor, ingresa tu Nombre de Cuenta.', 'error'); return; }
            if (!sellerSelect.value) { showMessage('Por favor, selecciona un vendedor.', 'error'); return; } 
            if (!countrySelect.value) { showMessage('Por favor, selecciona tu País.', 'error'); return; }
            
            const userId = userIdInput.value.trim();
            const userIdPattern = /^[0-9]*$/;
            if (!userIdPattern.test(userId)) {
                showMessage('El ID de Usuario solo debe contener números.', 'error');
                return;
            }

            showMessage('¡Transferencia confirmada! Ahora puedes enviar tu pedido por WhatsApp.', 'success');
            confirmTransferBtn.style.display = 'none'; 
            sendWhatsAppOrderBtn.style.display = 'block'; 
            transferWarningMessage.style.display = 'none'; 
        });


        // Manejador del envío del formulario (modificado para WhatsApp) - ahora activado por sendWhatsAppOrderBtn
        topupForm.addEventListener('submit', async (e) => {
            e.preventDefault(); 
            showWhatsAppWarningModal();
        });

        // Oyente de eventos para el botón "Confirmar y Enviar" en el modal (este es el que realmente envía a WhatsApp)
        confirmWhatsAppBtn.addEventListener('click', async () => {
            hideWhatsAppWarningModal(); 
            loadingOverlay.style.display = 'flex'; 

            gameHidden.value = selectedGame;
            amountUSDHidden.value = selectedAmountUSD;
            totalPriceHidden.value = totalPrice;
            currencySymbolHidden.value = currencySymbol;

            const selectedAmountLabel = gameOptions
                .find(g => g.name === selectedGame)
                ?.amounts.find(a => a.value === selectedAmountUSD)?.label || 'N/A';

            const sellerInfo = sellerData.find(seller => seller.name === selectedSeller);
            const whatsappRecipientNumber = sellerInfo ? sellerInfo.phoneNumber : DEFAULT_WHATSAPP_NUMBER; 
            
            // -----------------------------------------------------
            // YA NO SE ENVÍAN DATOS DE VENTA AL BACKEND AQUÍ.
            // La lógica de registro de ventas ha sido eliminada.
            // -----------------------------------------------------
            
            const whatsappMessageContent =
                `📝 *Pedido de Recarga - DHARCK STORE*:\n\n` +
                `🆔 *ID del Jugador*: ${userIdInput.value.trim()}\n` +
                `👤 *Nombre del Jugador*: ${userNameInput.value.trim()}\n` +
                `💼 *Vendedor*: ${selectedSeller}\n` + 
                `🎮 *Juego/Artículo*: ${selectedAmountLabel} (${selectedGame})\n` +
                `💸 *Monto a Pagar*: ${totalPrice.toFixed(2)} ${currencySymbol}\n` +
                `  _(Base: ${selectedAmountUSD.toFixed(2)} USD + comisión)_\n` +
                `🌎 *País*: ${selectedCountry}\n\n` +
                `⚠️ *¡Importante!*: Por favor, envíame el comprobante de pago.`;

            // Abrir WhatsApp en una nueva pestaña/ventana
            window.open(`https://wa.me/${whatsappRecipientNumber}?text=${encodeURIComponent(whatsappMessageContent)}`, '_blank');

            // Después de un breve retraso, ocultar la animación de carga y mostrar el mensaje de éxito
            setTimeout(() => {
                loadingOverlay.style.display = 'none'; 
                showMessage('¡Pedido Enviado! Abre WhatsApp para confirmar.', 'success'); 

                // Opcional: Limpiar el formulario después de un envío exitoso
                topupForm.reset();
                selectedGame = '';
                selectedAmountUSD = 0;
                selectedCountry = '';
                selectedSeller = ''; 
                gameSelect.value = ''; 
                countrySelect.value = ''; 
                sellerSelect.value = ''; 
                priceSummaryDiv.style.display = 'none'; 
                paymentMethodsDisplayDiv.style.display = 'none'; 
                amountSelectionDiv.style.display = 'none'; 
                amountButtonsDiv.innerHTML = '';
                
                confirmTransferBtn.style.display = 'block';
                sendWhatsAppOrderBtn.style.display = 'none';
                transferWarningMessage.style.display = 'block'; 
                updateConfirmTransferButtonState(); 
            }, 2000); 
        });

        // Oyente de eventos para el botón "Cancelar" en el modal
        cancelWhatsAppBtn.addEventListener('click', () => {
            hideWhatsAppWarningModal(); 
            showMessage('Envío de pedido cancelado.', 'info');
        });

       // Inicializar la página cuando se carga el DOM
        document.addEventListener('DOMContentLoaded', () => {
            loadGameOptions();
            loadSellerOptions(); 
            updateConfirmTransferButtonState(); 
            loadCountryOptions(); // Llama directamente a loadCountryOptions
        });

    </script>
</body>
</html>
�