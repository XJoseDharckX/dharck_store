<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RECARGAS DHARCK STORE</title>
    <!-- La ruta /image/logo1.png asume que 'logo1.png' est치 en la carpeta 'public/image/' en tu proyecto de Vercel. -->
    <link rel="icon" href="/image/logo1.png" type="image/png">
</head>
<body>

    <style>
        /* Fuentes */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #4A00E0, #8E2DE2, #FF00FF, #00FFFF, #00FF00); /* Degradado m치s claro y vibrante */
            background-size: 400% 400%;
            animation: gradient-animation 20s ease infinite; /* Animaci칩n m치s lenta y suave */

            display: flex;
            flex-direction: column; /* Cambiado a columna para apilar el header y el form-container */
            align-items: center;
            justify-content: flex-start; /* Alinear arriba para el header fijo */
            min-height: 100vh;
            margin: 0;
            position: relative;
            overflow-x: hidden;
            padding: 0; /* Remover padding aqu칤, se gestionar치 en el header y form-container */
            box-sizing: border-box;
        }
      
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* LOGO DE FONDO ELIMINADO */

        /* NUEVO ESTILO: Header de t칤tulo */
        .app-header {
            width: 100%;
            background: linear-gradient(to right, #1A004B, #6A0DAD, #1A004B); /* Degradado oscuro y vibrante para el header */
            padding: 15px 0; /* Padding vertical */
            box-shadow: 0 5px 25px rgba(138, 43, 226, 0.8), 0 0 40px rgba(0, 255, 255, 0.5); /* Sombra intensa */
            z-index: 100; /* Asegurar que est칠 por encima de todo */
            position: sticky; /* Se queda en la parte superior al hacer scroll */
            top: 0;
            display: flex;
            justify-content: center; /* Centrar el contenido horizontalmente */
            align-items: center; /* Centrar el contenido verticalmente */
            margin-bottom: 30px; /* Espacio entre el header y el formulario */
            border-bottom: 2px solid #00FFFF; /* Borde inferior de ne칩n */
        }

        .dharck-store-title-container {
            display: flex;
            align-items: center;
            justify-content: center; /* Centrar dentro del header */
            width: 100%; /* Ocupar todo el ancho disponible del header */
            max-width: 900px; /* Limitar ancho del contenido del t칤tulo */
            padding: 0 20px; /* Padding horizontal para el contenido del t칤tulo */
            box-sizing: border-box;
        }
        .dharck-store-title {
            /* Colores m치s definidos para el texto del t칤tulo */
            color: #00FFFF; /* Cian brillante, m치s legible */
            text-shadow: 0 0 10px rgba(0, 255, 255, 1), 0 0 20px rgba(0, 255, 255, 0.8), 0 0 30px rgba(0, 255, 255, 0.6); /* Resplandor cian */
            animation: none; /* Eliminar animaci칩n del t칤tulo para mayor claridad */
            font-weight: bold;
            font-size: 3.5em; /* T칤tulo a칰n m치s grande */
            line-height: 1;
            margin: 0;
            margin-right: 25px; /* M치s espacio entre texto y logo */
            background: none; /* Eliminar background-clip ya que ahora es color s칩lido */
            -webkit-background-clip: unset;
            background-clip: unset;
        }
        /* Animaci칩n para el t칤tulo (si se quiere mantener algo) */
        @keyframes header-neon-glow {
            0% { text-shadow: 0 0 8px #00FFFF, 0 0 15px #00FFFF, 0 0 25px #00FFFF; }
            50% { text-shadow: 0 0 12px #00FFFF, 0 0 20px #00FFFF, 0 0 35px #00FFFF; }
            100% { text-shadow: 0 0 8px #00FFFF, 0 0 15px #00FFFF, 0 0 25px #00FFFF; }
        }
        .dharck-store-title {
            animation: header-neon-glow 1.5s infinite alternate; /* Aplicar una animaci칩n de brillo */
        }

        .title-logo {
            height: 80px; /* Logo m치s grande en el header */
            width: auto;
            border-radius: 50%;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.8), 0 0 35px rgba(255, 0, 255, 0.8); /* Doble resplandor ne칩n */
            transition: transform 0.3s ease;
        }
        .title-logo:hover {
            transform: scale(1.05) rotate(5deg); /* Efecto de hover sutil */
        }

        /* Colores de los cuadros m치s claros y llamativos */
        .form-container, .section-container {
            background-color: #1A004B; /* Un color 칤ndigo m치s claro que el anterior, pero a칰n oscuro */
            border: 2px solid #6A0DAD; /* Borde morado brillante */
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 25px rgba(106, 13, 173, 0.6), /* Sombra morada */
                        0 0 35px rgba(0, 255, 255, 0.5), /* Sombra cian */
                        inset 0 0 12px rgba(106, 13, 173, 0.3); /* Resplandor interno */
            max-width: 900px;
            width: 100%;
            color: #E0F7FA;
            box-sizing: border-box;
            z-index: 1;
            position: relative;
            margin-top: 20px;
        }
        
        .section-container {
            margin-top: 30px;
        }

        /* Estilo para cada grupo de formulario (label + input/select) */
        .form-group {
            margin-bottom: 25px; /* M치s espacio entre grupos */
        }

        label {
            display: block;
            margin-bottom: 10px; /* M치s espacio debajo de la etiqueta */
            font-weight: bold;
            color: #00FFFF; /* Cian ne칩n */
            text-shadow: 0 0 6px rgba(0, 255, 255, 0.6);
            font-size: 1.2em; /* Etiquetas m치s grandes */
        }

        input[type="text"],
        input[type="tel"],
        input[type="email"],
        input[type="password"],
        select {
            width: 100%;
            padding: 14px; /* M치s padding */
            border: 2px solid #6A0DAD; /* Borde m치s pronunciado */
            border-radius: 10px; /* M치s redondeado */
            background-color: rgba(30, 0, 60, 0.9); /* Fondo oscuro con ligera transparencia */
            color: #FFFFFF; /* Texto blanco */
            font-size: 1.15em; /* Texto un poco m치s grande */
            transition: all 0.3s ease;
            box-shadow: inset 0 0 8px rgba(106, 13, 173, 0.3); /* Sombra interna sutil */
            height: 50px; /* Altura fija para celdas de selecci칩n, asegurando el mismo tama침o */
            box-sizing: border-box; /* Incluir padding y borde en la altura */
            -webkit-appearance: none; /* Eliminar estilo por defecto en Safari/Chrome */
            -moz-appearance: none; /* Eliminar estilo por defecto en Firefox */
            appearance: none; /* Eliminar estilo por defecto */
            /* Flecha SVG para selects, con color adaptable */
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="%2300FFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
        }

        input[type="text"]::placeholder,
        input[type="tel"]::placeholder,
        input[type="email"]::placeholder,
        input[type="password"]::placeholder {
            color: #B0B0B0; /* Placeholder m치s claro */
        }

        input[type="text"]:focus,
        input[type="tel"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        select:focus {
            outline: none;
            border-color: #00FF00; /* Borde verde ne칩n al enfocar */
            box-shadow: 0 0 0 4px rgba(0, 255, 0, 0.6), inset 0 0 10px rgba(0, 255, 0, 0.4); /* Resplandor m치s fuerte */
        }

        /* ESTILOS PARA LOS BOTONES DE JUEGO Y ART칈CULOS */
        #gameButtonsContainer, #amountButtons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Base para escritorio */
            gap: 20px; /* Espacio entre botones */
            justify-content: center;
            margin-top: 15px;
        }

        /* Estilos base para los elementos de juego y art칤culos */
        .game-item, .amount-item { /* Aplicamos estilos base a ambos */
            background-color: rgba(30, 0, 60, 0.7); /* Fondo oscuro con transparencia */
            border: 2px solid #8A2BE2; /* Borde morado */
            border-radius: 15px; /* M치s redondeado */
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.6); /* Sombra pronunciada */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 200px; /* Altura m칤nima uniforme, se ajustar치 individualmente si es necesario */
            text-align: center;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }

        .game-item::before, .amount-item::before { /* Efecto de brillo al pasar el rat칩n para ambos */
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.15) 0%, transparent 80%);
            transform: rotate(45deg);
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            opacity: 0;
            z-index: 0; /* Asegurar que el brillo est칠 detr치s del contenido */
        }
        .game-item:hover::before, .amount-item:hover::before {
            transform: rotate(45deg) translate(20%, 20%);
            opacity: 1;
        }
        .game-item:hover:not(.selected), .amount-item:hover:not(.selected) { /* Hover solo si no est치 seleccionado */
            background-color: rgba(138, 43, 226, 0.8); /* Morado m치s brillante */
            box-shadow: 0 8px 25px rgba(138, 43, 226, 1), 0 0 30px rgba(0, 255, 255, 0.5); /* Doble resplandor */
            transform: translateY(-8px); /* Efecto de elevaci칩n m치s notable */
        }

        /* Estilos para el estado seleccionado (aplicados a ambos) */
        .game-item.selected, .amount-item.selected {
            background: linear-gradient(to right, #00E676, #00FFFF); /* Degradado verde-cian intenso */
            border-color: #00FFFF;
            color: #1A052E; /* Texto oscuro */
            box-shadow: 0 0 30px rgba(0, 255, 255, 1), 0 0 40px rgba(0, 230, 118, 1); /* Resplandor muy brillante */
            transform: scale(1.08); /* Efecto de escala m치s pronunciado */
        }

        .game-logo {
            width: 120px; /* Tama침o del logo del juego */
            height: 120px;
            object-fit: contain;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5); /* Resplandor en el logo */
            z-index: 1; /* Asegurar que el logo est칠 encima del brillo */
        }

        .game-name-label {
            color: #FFFFFF; /* Texto blanco predeterminado */
            font-weight: bold;
            font-size: 1.3em; /* Texto del nombre del juego m치s grande */
            line-height: 1.3;
            z-index: 1; /* Asegurar que el texto est칠 encima del brillo */
        }

        .game-item.selected .game-name-label {
            color: #1A052E; /* Texto oscuro cuando est치 seleccionado */
        }
        /* FIN DE ESTILOS PARA LOS BOTONES DE JUEGO */


        /* Estilos espec칤ficos para el selector de art칤culos */
        .amount-item {
            min-height: 180px; /* Altura m칤nima uniforme, ligeramente menor que game-item */
            padding: 15px; /* Ajuste de padding */
        }
        .item-image {
            width: 100px; /* Im치genes m치s grandes */
            height: 100px;
            object-fit: contain;
            margin-bottom: 5px; /* Ajuste para separar de los labels */
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4); /* Peque침o resplandor en la imagen */
            z-index: 1; /* Asegurar que la imagen est칠 encima del brillo */
        }
        /* Contenedor para el label y el precio, para que queden apilados */
        .item-text-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%; /* Asegurar que ocupe el ancho disponible */
            z-index: 1; /* Asegurar que el texto est칠 encima del brillo */
        }
        .item-label {
            color: #FFFFFF; /* Texto blanco predeterminado */
            font-weight: bold;
            font-size: 1.2em; /* Texto m치s grande */
            line-height: 1.3;
            display: block; /* Asegura que el label est칠 en su propia fila */
            margin-bottom: 5px; /* Espacio entre label y precios */
            word-break: break-word; /* Romper palabras largas */
            overflow-wrap: break-word; /* Compatible con navegadores antiguos */
        }
        .amount-item.selected .item-label {
            color: #1A052E; /* Texto oscuro cuando est치 seleccionado */
        }
        .item-price-usd { /* NUEVO ESTILO: Precio en USD */
            color: #A9A9A9; /* Gris claro para el precio USD */
            font-size: 0.85em; /* Tama침o un poco m치s peque침o */
            font-weight: normal; /* No negrita */
            margin-bottom: 2px; /* Espacio entre USD y precio local */
        }
        .item-price-local { /* Estilo para el precio local */
            color: #00FF00; /* Verde ne칩n */
            font-size: 0.95em; /* Un poco m치s grande que el USD */
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
            display: block; /* Asegura que el precio est칠 en su propia fila */
        }

        /* Estilo para los art칤culos seleccionados en el resumen */
        #selectedItemsPreview {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 255, 255, 0.3); /* Separador sutil */
        }
        .selected-item-thumbnail {
            width: 50px;
            height: 50px;
            object-fit: contain;
            border-radius: 8px;
            border: 2px solid #00FFFF;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.6);
        }


        #priceSummary, #messageDisplay, #paymentMethodsDisplay {
            padding: 25px; /* M치s padding */
            border-radius: 15px; /* M치s redondeado */
            margin-top: 30px; /* M치s margen superior */
            text-align: center;
            background-color: rgba(30, 0, 60, 0.9); /* Fondo oscuro transl칰cido, consistente */
            border: 2px solid #8A2BE2; /* Borde morado ne칩n */
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5); /* Sombra m치s fuerte */
        }
        #priceSummary p, #paymentMethodsList p {
            color: #E0F7FA; /* Texto claro para legibilidad */
        }

        #totalPriceDisplay {
            font-weight: bold;
            color: #00FFFF; /* Cian ne칩n */
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8); /* Resplandor al total */
            font-size: 1.8em; /* Total m치s grande */
        }
        #currencySymbolDisplay {
            color: #00FF00; /* Verde ne칩n para el s칤mbolo de moneda */
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.8);
        }
        #baseAmountDisplay {
            color: #A9A9A9; /* Gris m치s claro para el monto base */
            font-size: 1em;
        }
        #paymentMethodsList p span {
            color: #00E676; /* Verde ne칩n para los nombres de los m칠todos */
            font-weight: bold;
        }

        /* Visualizaci칩n de mensajes */
        #messageDisplay {
            font-weight: bold;
            padding: 20px;
            border-radius: 10px;
            text-shadow: 0 0 5px rgba(0,0,0,0.2);
            color: white;
            font-size: 1.1em;
        }
        .message-error {
            background-color: #A30000; /* Rojo oscuro vibrante */
            border: 2px solid #FF5555;
            color: #FFDDDD; /* Texto rojo muy claro */
        }
        .message-success {
            background-color: #007A00; /* Verde oscuro vibrante */
            border: 2px solid #00FF00;
            color: #DDFFDD; /* Texto verde muy claro */
        }
        .message-info {
            background-color: #0000A3; /* Azul oscuro vibrante */
            border: 2px solid #5555FF;
            color: #DDEEFF; /* Texto azul muy claro */
        }
        /* Advertencia de transferencia */
        .transfer-warning {
            background-color: #E25822; /* Naranja m치s oscuro */
            border: 3px solid #FFD700; /* Borde amarillo brillante m치s grueso */
            color: #2A0000; /* Texto oscuro para alto contraste */
            font-weight: bold;
            padding: 22px; /* M치s padding */
            border-radius: 15px; /* M치s redondeado */
            margin-top: 30px; /* M치s margen superior */
            text-align: center;
            box-shadow: 0 0 25px rgba(255, 100, 50, 0.9), 0 0 40px rgba(255, 215, 0, 0.9); /* Doble resplandor ne칩n */
            animation: pulse-warning 1.8s infinite alternate; /* Animaci칩n de pulsaci칩n m치s lenta */
        }

        /* Estilos de botones de acci칩n */
        .action-button { 
            background: linear-gradient(to right, #00e676, #00c853); /* Degradado verde ne칩n */
            color: #0d001a; /* Texto muy oscuro en el bot칩n ne칩n */
            padding: 15px 20px; /* M치s padding para mayor tama침o */
            border: none;
            border-radius: 10px; /* M치s redondeado */
            cursor: pointer;
            font-size: 1.2em; /* Texto m치s grande */
            font-weight: bold;
            display: block; /* Asegura que ocupe su propia l칤nea y se pueda centrar */
            max-width: 450px; /* Ancho m치ximo para el bot칩n */
            margin: 20px auto 0 auto; /* Centrar horizontalmente y a침adir margen superior */
            box-shadow: 0 5px 20px rgba(0, 230, 118, 0.7); /* Sombra con resplandor verde ne칩n */
            transition: all 0.3s ease;
        }

        .action-button:hover:not(:disabled) { /* Hover solo si no est치 deshabilitado */
            background: linear-gradient(to right, #00c853, #00ffff); /* Verde a cian ne칩n al pasar el rat칩n */
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.8); /* Resplandor cian al pasar el rat칩n */
            transform: translateY(-3px) scale(1.01); /* Efecto 3D sutil */
        }

        .action-button:disabled { /* Estilo para botones deshabilitados */
            background: linear-gradient(to right, #505050, #707070); /* Degradado gris sutil */
            color: #A0A0A0; /* Texto gris claro */
            cursor: not-allowed;
            opacity: 0.8; /* Menos opacidad para indicar inactividad */
            box-shadow: 0 2px 10px rgba(0,0,0,0.4); /* Sombra sutil para profundidad */
            transform: none; /* Eliminar transform en disabled */
        }

        /* Estilo espec칤fico para el bot칩n de confirmar transferencia */
        #confirmTransferBtn {
            background: linear-gradient(to right, #FF00FF, #8a2be2); /* Degradado magenta-morado ne칩n */
            box-shadow: 0 5px 20px rgba(255, 0, 255, 0.7); /* Sombra con resplandor magenta ne칩n */
        }
        #confirmTransferBtn:hover:not(:disabled) {
            background: linear-gradient(to right, #8a2be2, #FF00FF); /* Degradado invertido */
            box-shadow: 0 8px 25px rgba(255, 0, 255, 0.8); /* Resplandor m치s fuerte */
        }


        /* Estilos del modal (advertencia WhatsApp) */
        #whatsappWarningModal > div {
            background-color: rgba(20, 0, 50, 0.98); /* Fondo oscuro casi opaco */
            border: 3px solid #00FFFF; /* Borde cian ne칩n m치s grueso */
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.8); /* Sombra con resplandor cian m치s fuerte */
            color: #E0F7FA; /* Texto principal claro */
            padding: 30px;
            border-radius: 15px;
        }
        #whatsappWarningModal h2 {
            color: #00FFFF; /* Cian ne칩n */
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            font-size: 1.8em;
        }
        #whatsappWarningModal p {
            color: #E0F7FA;
            font-size: 1.1em;
        }
        #whatsappWarningModal p span {
            color: #FF00FF; /* Magenta ne칩n */
            text-shadow: 0 0 8px rgba(255, 0, 255, 0.7);
        }
        #whatsappWarningModal #cancelWhatsApp,
        #whatsappWarningModal #confirmWhatsApp {
            padding: 12px 25px; /* Botones m치s grandes */
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1em;
            margin: 10px;
        }
        #whatsappWarningModal #cancelWhatsApp {
            background-color: #555555;
            color: #E0F7FA;
            border: 1px solid #777777;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
        }
        #whatsappWarningModal #cancelWhatsApp:hover {
            background-color: #777777;
            box-shadow: 0 5px 12px rgba(0,0,0,0.6);
        }
        #whatsappWarningModal #confirmWhatsApp {
            background: linear-gradient(to right, #00E676, #00FFFF);
            color: #1A052E;
            box-shadow: 0 5px 18px rgba(0, 255, 255, 0.8);
        }
        #whatsappWarningModal #confirmWhatsApp:hover {
            background: linear-gradient(to right, #00FFFF, #00E676);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 1);
        }

        /* Estilos para la animaci칩n de carga */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            animation: pulse-text 1.5s infinite alternate; /* Animaci칩n de pulsaci칩n para el texto de carga */
        }
        @keyframes pulse-text {
            0% { opacity: 0.7; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.05); }
        }

        /* Media Queries para Responsive Design */
        @media (max-width: 992px) { /* Tablets y pantallas medianas */
            #gameButtonsContainer, #amountButtons {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); /* Intentar치 3+ columnas */
                gap: 18px;
            }
        }

        @media (max-width: 768px) { /* Tabletas peque침as y m칩viles grandes */
            .app-header {
                padding: 10px 0;
            }
            .dharck-store-title {
                font-size: 2.2em; /* Reducir tama침o del t칤tulo en m칩vil */
                margin-right: 15px;
            }
            .title-logo {
                height: 50px; /* Reducir tama침o del logo en m칩vil */
            }
            .form-container, .section-container { /* Aplicar a ambos contenedores */
                padding: 20px;
                border-radius: 15px;
                margin-top: 20px; /* Ajustar margen */
            }
            /* Ajuste para los botones de juego y art칤culos en m칩vil */
            #gameButtonsContainer, #amountButtons {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* Intentar치 3-4 columnas */
                gap: 15px;
            }
            .game-item {
                min-height: 160px;
                padding: 15px;
            }
            .game-logo {
                width: 90px;
                height: 90px;
            }
            .game-name-label {
                font-size: 1.1em;
            }
            .amount-item {
                min-height: 140px; /* Altura ajustada para art칤culos en m칩vil */
                padding: 15px;
            }
            .item-image {
                width: 70px;
                height: 70px;
            }
            .item-label {
                font-size: 1em;
            }
            label {
                font-size: 1.1em;
            }
            input[type="text"], input[type="tel"], input[type="email"], input[type="password"], select {
                padding: 10px;
                font-size: 1em;
                height: 45px; /* Ajustar altura para m칩vil */
            }
            .action-button {
                padding: 12px 15px;
                font-size: 1.1em;
                max-width: 90%; /* Ajustar ancho m치ximo para m칩vil */
            }
            #whatsappWarningModal > div {
                max-width: 90%;
            }
        }

        @media (max-width: 576px) { /* M칩viles peque침os a medianos */
            #gameButtonsContainer, #amountButtons {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* Intentar치 3 columnas, pero puede caer a 2 si el espacio es muy reducido */
                gap: 10px;
            }
            .game-item {
                min-height: 140px;
            }
            .amount-item {
                min-height: 120px;
            }
        }

        @media (max-width: 400px) { /* M칩viles muy peque침os */
            .app-header {
                padding: 8px 0;
            }
            .dharck-store-title {
                font-size: 1.8em;
                margin-right: 10px;
            }
            .title-logo {
                height: 40px;
            }
            #gameButtonsContainer, #amountButtons {
                grid-template-columns: repeat(2, 1fr); /* Garantiza 2 columnas */
                gap: 8px;
            }
            .game-item {
                min-height: 120px;
            }
            .game-logo {
                width: 80px;
                height: 80px;
            }
            .amount-item {
                min-height: 110px;
            }
            .form-container, .section-container { /* Aplicar a ambos contenedores */
                padding: 15px;
                margin-top: 15px; /* Ajustar margen */
            }
        }

    </style>

    <!-- Header para el t칤tulo de la aplicaci칩n -->
    <header class="app-header">
        <div class="dharck-store-title-container">
            <h1 class="dharck-store-title">
                DHARCK STORE
            </h1>
            <!-- La ruta /logo.png asume que 'logo.png' est치 directamente en la carpeta 'public/' en tu proyecto de Vercel. -->
            <img src="/image/logo.png" alt="Logotipo de la TIENDA DHARCK" class="title-logo">    
        </div>
    </header>

    <!-- Nuevo contenedor para la selecci칩n de pa칤s - MOVIDO ARRIBA -->
    <div class="section-container" id="countrySelectionSection">
        <div class="form-group">
            <label for="country">
                SELECCIONA TU PAIS:
            </label>
            <select
                id="country"
                name="country"
                required
            >
                <!-- Opci칩n inicial vac칤a para forzar la selecci칩n -->
                <option value="">-- ELIGE TU PAIS --</option> 
            </select>
        </div>
    </div>

    <!-- Nuevo contenedor para la selecci칩n de juegos -->
    <div class="section-container" id="gameSelectionSection">
        <div class="form-group">
            <label>
                SELECCIONA EL JUEGO:
            </label>
            <div id="gameButtonsContainer">
                <!-- Los botones de juego se generar치n aqu칤 con JS -->
            </div>
        </div>
    </div>

    <!-- Contenedor principal del formulario, ahora contiene los art칤culos, campos de usuario, vendedor y resumen de pedido -->
    <div class="form-container">
        <form id="topupForm">
            <div id="amountSelection" class="form-group" style="display: none;">
                <label>
                    SELECCIONA EL ARTICULO(S):
                </label>
                <div id="amountButtons">
                    <!-- Los divs de los art칤culos se generar치n aqu칤 con JS -->
                </div>
            </div>

            <!-- Secci칩n de informaci칩n del jugador, contendr치 los campos din치micos -->
            <div id="userInfoSection">
                <!-- ID y Nombre (Para Lords Mobile, Free Fire, Mobile Legends) -->
                <div id="idNameInputs" style="display: none;">
                    <div class="form-group">
                        <label for="userId">
                            ID DEL JUGADOR:
                        </label>
                        <input
                            type="tel"
                            id="userId"
                            name="userId"
                            placeholder="Ej: 1234567890"
                            pattern="[0-9]*"
                            title="Por favor, ingresa solo n칰meros."
                        />
                    </div>
                    <div class="form-group">
                        <label for="userName">
                            NOMBRE DEL JUGADOR:
                        </label>
                        <input
                            type="text"
                            id="userName"
                            name="userName"
                            placeholder="Ej: ElCojeViejas300"
                        />
                    </div>
                </div>

                <!-- ID y Servidor (Para Genshin Impact, Mobile Legends) -->
                <div id="idServerInputs" style="display: none;">
                    <div class="form-group">
                        <label for="userIdServer">
                            ID DEL JUGADOR (UID):
                        </label>
                        <input
                            type="tel"
                            id="userIdServer"
                            name="userIdServer"
                            placeholder="Ej: 123456789 (UID)"
                            pattern="[0-9]*"
                            title="Por favor, ingresa solo n칰meros para el UID."
                        />
                    </div>
                    <div class="form-group">
                        <label for="serverInput">
                            SERVIDOR:
                        </label>
                        <input
                            type="text"
                            id="serverInput"
                            name="serverInput"
                            placeholder="Ej: Am칠rica, Asia, Europa"
                        />
                    </div>
                    <!-- Nombre del jugador para Mobile Legends, si aplica en este grupo -->
                    <div class="form-group" id="mlNameInput" style="display: none;">
                        <label for="userNameML">
                            NOMBRE DEL JUGADOR:
                        </label>
                        <input
                            type="text"
                            id="userNameML"
                            name="userNameML"
                            placeholder="Ej: MiNombreDeML"
                        />
                    </div>
                </div>

                <!-- ID Solamente (Para Blood Strike, PUBG Mobile, Delta Force) -->
                <div id="idOnlyInputs" style="display: none;">
                    <div class="form-group">
                        <label for="userIdOnly">
                            ID DEL JUGADOR:
                        </label>
                        <input
                            type="tel"
                            id="userIdOnly"
                            name="userIdOnly"
                            placeholder="Ej: 1234567890"
                            pattern="[0-9]*"
                            title="Por favor, ingresa solo n칰meros."
                        />
                    </div>
                </div>

                <!-- Campos completos para Call of Duty Mobile -->
                <div id="codInputs" style="display: none;">
                    <div class="form-group">
                        <label for="emailInput">
                            CORREO ELECTR칍NICO:
                        </label>
                        <input
                            type="email"
                            id="emailInput"
                            name="emailInput"
                            placeholder="Ej: tu_correo@example.com"
                        />
                    </div>
                    <div class="form-group">
                        <label for="passwordInput">
                            CONTRASE칌A:
                        </label>
                        <input
                            type="password"
                            id="passwordInput"
                            name="passwordInput"
                            placeholder="Ingresa tu contrase침a"
                        />
                    </div>
                    <div class="form-group">
                        <label for="linkageInput">
                            VINCULACI칍N (Gmail, Facebook, Activision):
                        </label>
                        <input
                            type="text"
                            id="linkageInput"
                            name="linkageInput"
                            placeholder="Ej: Gmail"
                        />
                    </div>
                    <div class="form-group">
                        <label for="exactAccountNameInput">
                            NOMBRE EXACTO DE LA CUENTA:
                        </label>
                        <input
                            type="text"
                            id="exactAccountNameInput"
                            name="exactAccountNameInput"
                            placeholder="Ej: TuNombreExactoEnCOD"
                        />
                    </div>
                </div>
            </div> <!-- Fin de userInfoSection -->

            <div class="form-group">
                <label for="seller">
                    SELECCIONA EL VENDEDOR:
                </label>
                <select
                    id="seller"
                    name="seller"
                    required
                >
                    <option value="">-- ELIGE UN VENDEDOR --</option>
                </select>
            </div>

            <!-- La selecci칩n de pa칤s se movi칩 a la parte superior -->
            <input type="hidden" id="gameHidden" name="game">
            <input type="hidden" id="amountUSDHidden" name="amountUSD">
            <input type="hidden" id="totalPriceHidden" name="totalPrice">
            <input type="hidden" id="currencySymbolHidden" name="currencySymbol">


            <div id="priceSummary" style="display: none;">
                <p>RESUMEN DE PEDIDO:</p>
                <div id="selectedItemsPreview">
                    <!-- Las miniaturas de los art칤culos seleccionados se mostrar치n aqu칤 -->
                </div>
                <p>
                    TOTAL A PAGAR: <span id="totalPriceDisplay"></span> <span id="currencySymbolDisplay"></span>
                </p>
                <p>
                    (BASADO EN <span id="baseAmountDisplay"></span> USD + COMISION!)
                </p>
            </div>

            <div id="paymentMethodsDisplay" style="display: none;">
                <p>METODOS DE PAGOS:</p>
                <div id="paymentMethodsList"></div>
            </div>

            <div id="transferWarningMessage" class="transfer-warning">
                춰Advertencia! No oprimas el bot칩n de "CONFIRMAR QUE HAZ PAGADO" si a칰n no has realizado el pago. Recuerda guardar una imagen del comprobante de pago. La entrega puede demorar entre 5 a 15 minutos en reflejarse en el juego
            </div>

            <button
                type="button"
                id="confirmTransferBtn"
                class="action-button"
                disabled="true"
            >
                춰CONFIRMAR QUE HAZ PAGADO! 
            </button>

            <button
                type="submit"
                id="sendWhatsAppOrderBtn"
                class="action-button"
                style="display: none;"
            >
                ENVIAR EL PEDIDO
            </button>

            <div id="messageDisplay" style="display: none;"></div>
        </form>
    </div>

    <div id="whatsappWarningModal" style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 1000; display: none;">
        <div style="background-color: rgba(10, 0, 30, 0.95); padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 400px; width: 100%; text-align: center;">
            <h2>춰Importante!</h2>
            <p style="color: #e0f2fe;">
                Tu pedido ser치 enviado por WhatsApp.
                <span style="color: #ff00ff;">Recuerda enviar el comprobante de pago por WhatsApp despu칠s de confirmar el pedido.</span>
            </p>
            <div>
                <button id="cancelWhatsApp" type="button">
                    Cancelar
                </button>
                <button id="confirmWhatsApp" type="button">
                    Confirmar y Enviar
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay (NUEVO) -->
    <div id="loadingOverlay" style="position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); z-index: 1001; color: white; display: none;">
        <div class="spinner" style="border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #00ffff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;"></div>
        <p style="margin-top: 15px; font-size: 1.2em; color: #00ffff; text-shadow: 0 0 8px rgba(0, 255, 255, 0.6);" class="loading-text">Cargando...</p>
    </div>

    <script type="module">

        // N칰mero de WhatsApp Business predeterminado (fallback si no se encuentra el vendedor)
        const DEFAULT_WHATSAPP_NUMBER = '584126027407'; 

        // Elementos ocultos (ahora solo para datos del formulario)
        const gameHidden = document.getElementById('gameHidden');
        const amountUSDHidden = document.getElementById('amountUSDHidden');
        const totalPriceHidden = document.getElementById('totalPriceHidden');
        const currencySymbolHidden = document.getElementById('currencySymbolHidden');

        // Referencias al modal
        const whatsappWarningModal = document.getElementById('whatsappWarningModal');
        const confirmWhatsAppBtn = document.getElementById('confirmWhatsApp');
        const cancelWhatsAppBtn = document.getElementById('cancelWhatsApp');

        // Nuevos botones de acci칩n
        const confirmTransferBtn = document.getElementById('confirmTransferBtn');
        const sendWhatsAppOrderBtn = document.getElementById('sendWhatsAppOrderBtn');
        const loadingOverlay = document.getElementById('loadingOverlay'); // Referencia al overlay de carga

        // Elementos del DOM para campos din치micos
        const countrySelectionSection = document.getElementById('countrySelectionSection'); // Nueva secci칩n para pa칤s
        const gameSelectionSection = document.getElementById('gameSelectionSection');
        const amountSelectionDiv = document.getElementById('amountSelection');
        const userInfoSection = document.getElementById('userInfoSection'); // Nuevo contenedor para todos los campos de usuario
        const idNameInputs = document.getElementById('idNameInputs');
        const userIdInput = document.getElementById('userId'); 
        const userNameInput = document.getElementById('userName'); 

        const idServerInputs = document.getElementById('idServerInputs');
        const userIdServerInput = document.getElementById('userIdServer');
        const serverInput = document.getElementById('serverInput');
        const userNameMLInput = document.getElementById('userNameML'); 

        const idOnlyInputs = document.getElementById('idOnlyInputs');
        const userIdOnlyInput = document.getElementById('userIdOnly');

        const codInputs = document.getElementById('codInputs');
        const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const linkageInput = document.getElementById('linkageInput');
        const exactAccountNameInput = document.getElementById('exactAccountNameInput');


        // Datos de juegos y sus precios base en USD
        // Se a침ade 'logoUrl' para cada juego para los botones.
        // NOTA: Aseg칰rate de que todas las im치genes referenciadas aqu칤 (logoUrl y imageUrl)
        // existan en tu carpeta 'public/image/' en Vercel y que est칠n optimizadas (comprimidas)
        // para una carga r치pida de la p치gina.
        const gameOptions = [
            { name: 'LORDS MOBILE', logoUrl: '/image/lm1.png', inputRequirement: 'id_name', amounts: [
                { value: 2.30, label: 'PASE SEMANAL', imageUrl: '/image/7day.png' },
                { value: 19.90, label: 'PASE MENSUAL', imageUrl: '/image/30day.png' },
                { value: 2.30, label: '209游눑', imageUrl: '/image/prize-2.png' },
                { value: 5.20, label: '524游눑', imageUrl: '/image/prize-3.png' },
                { value: 10.00, label: '1048游눑', imageUrl: '/image/prize-4.png' },
                { value: 19.50, label: '2096游눑', imageUrl: '/image/prize-5.png' },
                { value: 29.00, label: '3144游눑', imageUrl: '/image/prize-6.png' },
                { value: 48.00, label: '5240游눑', imageUrl: '/image/prize-6.png' },
                { value: 62.00, label: '6812游눑', imageUrl: '/image/prize-6.png' },
                { value: 92.00, label: '9956游눑', imageUrl: '/image/prize-7.png' },
                { value: 178.00, label: '19912游눑', imageUrl: '/image/prize-7.png' },
                { value: 270.00, label: '30392游눑', imageUrl: '/image/prize-7.png' },
                { value: 440.00, label: '50304游눑', imageUrl: '/image/icon-happy.png' },
            ] },
//            { name: 'LORDS MOBILE PROMOCION', logoUrl: '/image/lm2.png', inputRequirement: 'id_name', amounts: [
//                { value: 5.20, label: '游눑499+', imageUrl: '/image/prize-2.png' },
//                { value: 12.00, label: '游눑999+', imageUrl: '/image/prize-3.png' },
//                { value: 20.00, label: '游눑1999+', imageUrl: '/image/prize-4.png' },
//                { value: 25.50, label: '游눑2499+', imageUrl: '/image/prize-5.png' },
//                { value: 30.00, label: '游눑2999+', imageUrl: '/image/prize-6.png' },
//                { value: 48.50, label: '游눑4999+', imageUrl: '/image/prize-7.png' },
//                { value: 95.00, label: '游눑9999+', imageUrl: '/image/icon-happy.png' },
//            ] },
            { name: 'BLOOD STRIKE', logoUrl: '/image/bs.png', inputRequirement: 'id_only', amounts: [
                { value: 0.89, label: '100+5游븯', imageUrl: '/image/100.png' },
                { value: 2.50, label: '300+20游븯', imageUrl: '/image/300.png' },
                { value: 4.30, label: '500+40游븯', imageUrl: '/image/500.png' },
                { value: 8.50, label: '1000+100游븯', imageUrl: '/image/1000.png' },
                { value: 17.60, label: '2000+200游븯', imageUrl: '/image/2000.png' },
                { value: 42.00, label: '5000+800游븯', imageUrl: '/image/5000.png' },
                { value: 3.50, label: 'PASE ELITE游븯', imageUrl: '/image/elite.png' },
                { value: 8.51, label: 'PASE PREMIUM游븯', imageUrl: '/image/premium.png' },
                { value: 2.00, label: 'PASE DE NIVEL游븯', imageUrl: '/image/mejora.png' },
            ] },
            { name: 'FREE FIRE', logoUrl: '/image/ff1.png', inputRequirement: 'id_name', amounts: [
                { value: 1.80, label: '游눑SEMANAL', imageUrl: '/image/ffs.png' },
                { value: 8.50, label: '游눑MENSUAL', imageUrl: '/image/ffm.png' },
                { value: 0.99, label: '游눑100+10', imageUrl: '/image/prize-2.png' },
                { value: 1.90, label: '游눑200+20', imageUrl: '/image/prize-3.png' },
                { value: 2.80, label: '游눑310+31', imageUrl: '/image/prize-4.png' },
                { value: 4.60, label: '游눑520+52', imageUrl: '/image/prize-5.png' },
                { value: 9.50, label: '游눑1069+106', imageUrl: '/image/prize-6.png' },
                { value: 18.00, label: '游눑2180+218', imageUrl: '/image/prize-7.png' },
                { value: 40.00, label: '游눑5600+560', imageUrl: '/image/prize-7.png' },
            ] },
            { name: 'GENSHIN IMPACT', logoUrl: '/image/gi.png', inputRequirement: 'id_server', amounts: [
                { value: 4.8, label: 'PASE LUNAR', imageUrl: '/image/bl.png' },
                { value: 0.90, label: '60', imageUrl: '/image/cg1.png' },
                { value: 4.70, label: '300+30', imageUrl: '/image/cg2.png' },
                { value: 13.00, label: '980+110', imageUrl: '/image/cg3.png' },
                { value: 27.00, label: '1980+260', imageUrl: '/image/cg4.png' },
                { value: 45.50, label: '3280+600', imageUrl: '/image/cg5.png' },
                { value: 90.00, label: '6480+1600', imageUrl: '/image/cg6.png' },
            ] },
            { name: 'PUBG MOBILE', logoUrl: '/image/pm1.png', inputRequirement: 'id_only', amounts: [
                { value: 0.99, label: '60', imageUrl: '/image/pm.png' },
                { value: 4.85, label: '300+25', imageUrl: '/image/pm.png' },
                { value: 9.00, label: '600+60', imageUrl: '/image/pm.png' },
                { value: 23.00, label: '1500+300', imageUrl: '/image/pm.png' },
                { value: 45.00, label: '3000+850', imageUrl: '/image/pm.png' },
                { value: 92.00, label: '6000+2100', imageUrl: '/image/pm.png' },
            ] },
            { name: 'DELTA FORCE STEAM', logoUrl: '/image/dfss.png', inputRequirement: 'id_only', amounts: [
                { value: 0.99, label: '60 Coins', imageUrl: '/image/dfs1.png' },
                { value: 4.70, label: '300+20 Coins', imageUrl: '/image/dfs1.png' },
                { value: 6.80, label: '420+40 Coins', imageUrl: '/image/dfs2.png' },
                { value: 9.00, label: '680+70 Coins', imageUrl: '/image/dfs2.png' },
                { value: 17.00, label: '1280+200 Coins', imageUrl: '/image/dfs3.png' },
                { value: 21.00, label: '1680+300 Coins', imageUrl: '/image/dfs3.png' },
                { value: 40.00, label: '3280+670 Coins', imageUrl: '/image/dfs4.png' },
                { value: 80.00, label: '6480+1620 Coins', imageUrl: '/image/dfs4.png' },
                { value: 174.00, label: '12960+3240 Coins', imageUrl: '/image/dfs5.png' },
                { value: 260.00, label: '19440+4860 Coins', imageUrl: '/image/dfs5.png' },
            ] },
            { name: 'DELTA FORCE GARENA', logoUrl: '/image/dfsg.png', inputRequirement: 'id_only', amounts: [
                { value: 0.99, label: '60 Coins', imageUrl: '/image/dfs1.png' },
                { value: 4.80, label: '300+36 Coins', imageUrl: '/image/dfs1.png' },
                { value: 7.00, label: '420+62 Coins', imageUrl: '/image/dfs2.png' },
                { value: 9.60, label: '680+105 Coins', imageUrl: '/image/dfs2.png' },
                { value: 19.00, label: '1280+264 Coins', imageUrl: '/image/dfs3.png' },
                { value: 23.50, label: '1680+385 Coins', imageUrl: '/image/dfs3.png' },
                { value: 45.00, label: '3280+834 Coins', imageUrl: '/image/dfs4.png' },
                { value: 88.00, label: '6480+1944 Coins', imageUrl: '/image/dfs4.png' },
                { value: 180.00, label: '12960+3888 Coins', imageUrl: '/image/dfs5.png' },
                { value: 270.00, label: '19440+5832 Coins', imageUrl: '/image/dfs5.png' },
            ] },
            { name: 'CALL OF DUTY MOBILE', logoUrl: '/image/codm.png', inputRequirement: 'cod_full', amounts: [
                { value: 1.50, label: '80 CP', imageUrl: '/image/cm1.png' },
                { value: 5.50, label: '420 CP', imageUrl: '/image/cm1.png' },
                { value: 11.00, label: '880 CP', imageUrl: '/image/cm2.png' },
                { value: 26.00, label: '2400 CP', imageUrl: '/image/cm2.png' },
                { value: 55.00, label: '5000 CP', imageUrl: '/image/cm4.png' },
                { value: 110.00, label: '10800 CP', imageUrl: '/image/cm4.png' },
            ] },
            
//            { name: 'MOBILE LEGENDS', logoUrl: '/image/ml.png', inputRequirement: 'id_server_name', amounts: [
//                { value: 0.89, label: '50游눑', imageUrl: '/image/ml_50.png' },
//                { value: 2.50, label: '100游눑', imageUrl: '/image/ml_100.png' },
//                { value: 4.30, label: '150游눑', imageUrl: '/image/ml_150.png' },
//                { value: 8.50, label: '200游눑', imageUrl: '/image/ml_200.png' },
//                { value: 17.60, label: '250游눑', imageUrl: '/image/ml_250.png' },
//                { value: 42.00, label: '300游눑', imageUrl: '/image/ml_300.png' },
//            ] },
            // Puedes a침adir m치s juegos aqu칤
        ];

        // Datos de pa칤ses y tasas de cambio (AHORA HARDCODEADOS DIRECTAMENTE EN EL FRONTEND)
        let countryData = [
            {
                name: 'VENEZUELA',
                code: 'VES',
                exchangeRate: 142, // Tasa de cambio directa
                symbol: 'Bs.',
                paymentMethods: [
                    { name: 'Pago M칩vil', details: 'C.I.: V-32147818, Tel칠fono: 04126027407, Banco: 0105 (Banco Mercantil)' },
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'COLOMBIA',
                code: 'COP',
                exchangeRate: 4300,
                symbol: 'COP',
                paymentMethods: [
                    { name: 'Nequi', details: 'N칰mero: 3012660676 Nombre:Ali.' },
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'PERU',
                code: 'PEN',
                exchangeRate: 3.9,
                symbol: 'S/.',
                paymentMethods: [
                    { name: 'BCP', details: 'Cuenta: 38097062947042, Titular: Yoshimara' },
                    { name: 'Yape', details: 'N칰mero: 974610375' },
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'MEXICO',
                code: 'MXN',
                exchangeRate: 20.1,
                symbol: 'MXN',
                paymentMethods: [
                    { name: 'SPIN BY OXXO', details: 'TARJETA: 4217 4701 8364 0099' },
                    { name: 'BANCO AZTECA', details: 'INTERBANCARIA: 1277 9700 1467 5859 00' },
                    { name: 'Titular', details: 'Jesus Carrillo' },
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'ESTADOS UNIDOS',
                code: 'USD',
                exchangeRate: 1.05, 
                symbol: '$',
                paymentMethods: [
                    { name: 'Zelle', details: '+1 (661) 736 - 0564, Nombre: Jannett Martinez Lopez' },
                    { name: 'Titular', details: 'Jannett Martinez Lopez' },
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'ARGENTINA',
                code: 'ARS',
                exchangeRate: 1270,
                symbol: '$',
                paymentMethods: [
                    { name: 'Mercado pago', details: '0000003100069089540216' },
                    { name: 'UALA', details: '3840200500000000199867' },
                    { name: 'Titular', details: 'Pamela Schneider' },
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'ECUADOR',
                code: 'USD',
                exchangeRate: 1.06,
                symbol: '$',
                paymentMethods: [
                    { name: 'Banco Pichincha', details: 'Cta. ahorros 2204277346' },
                    { name: 'Banco de Guayaquil', details: 'Cta. ahorros 0039924590' },
                    { name: 'Titular', details: 'Mar칤a de los 츼ngeles Ronquillo Le칩n. CI: 0941414203' },
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            {
                name: 'CHILE',
                code: 'CLP',
                exchangeRate: 1010,
                symbol: '$',
                paymentMethods: [
                    { name: 'BANCO FALABELLA', details: 'RUT: 17244216-1 / gi553ll30@gmail.com / Cta Corriente: 1-983-036407-8' },
                    { name: 'BANCO ESTADO', "details": 'RUT: 17244216-1 / Cta Corriente: 37100135052 / 300 PESOS EXTRAS AL VALOR TOTAL'},
                    { name: 'Titular', "details": 'GISSELLE GONZALEZ'},
                    { name: '춰IMPORTANTE!', "details": '춰No colocar conceptos EN LOS PAGOS!'},
                ]
            },
            {
                name: 'ESPA칌A',
                code: 'EUR',
                exchangeRate: 1.03,
                symbol: '',
                paymentMethods: [
                    { name: 'BIZUM', details: '612237372 / 614153840 / CUALQUIERA DE LOS DOS' },
                    { name: 'BANCO SANTANDER', details: 'Cuenta bancaria : ES0800495939582916425258' },
                    { name: 'Titular', details: 'MAX FRANCIS SILVA RAMOS' },
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            { 
                name: 'COSTA RICA',
                code: 'CRC',
                exchangeRate: 600,
                symbol: '',
                paymentMethods: [
                    { name: 'SIMPE', details: '63223852' },
                    { name: 'Titular', details: 'Solange Granja Duarte' },
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            { 
                name: 'BOLIVIA',
                code: 'BOB',
                exchangeRate: 16.7,
                symbol: 'Bs.', 
                paymentMethods: [
                    { name: 'Banco ganadero', details: '1311307078' }, 
                    { name: 'Tigo Money', details: '69172559' }, 
                    { name: 'Titular', details: 'Brandon Salazar Guti칠rrez'}, 
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
            { 
                name: 'NICARAGUA',
                code: 'NIO',
                exchangeRate: 43,
                symbol: 'C$', 
                paymentMethods: [
                    { name: 'BAC C칍RDOBAS', details: 'Email: Nomiflores72@gmail.com' }, 
                    { name: 'Cta. ahorros:', details: '363278672' }, 
                    { name: 'Titular', details: 'Nahomi Flores Vel치squez'}, 
                    { name: '춰IMPORTANTE!', details: '춰No colocar conceptos EN LOS PAGOS!' },
                ]
            },
        ];

        // Datos de vendedores (ACTUALIZADOS)
        const sellerData = [
            { name: 'XJoseDharckX', phoneNumber: '584126027407' },
            { name: 'Miguel', phoneNumber: '5214951219766' }, 
            { name: 'Alfredo Favier', phoneNumber: '5353148505' }, 
            { name: 'Candy Candy', phoneNumber: '584144274483' }, 
            { name: 'Satoru', phoneNumber: '5491170897494' }, 
            { name: 'Ernesto', phoneNumber: '573025129990' }, 
            { name: 'OSCAR', phoneNumber: '573002030533' },
            // Puedes a침adir m치s vendedores aqu칤 si es necesario
        ];

        let selectedGame = '';
        let selectedAmount = null; // Un solo art칤culo seleccionado (objeto)
        let selectedCountry = ''; 
        let selectedSeller = ''; 
        let totalPrice = 0;
        let currencySymbol = 'USD';
        // Se asegura que defaultCountryInfo exista, usando un valor por defecto si no se encuentra 'USD'
        let defaultCountryInfo = countryData.find(c => c.code === 'USD') || { name: 'ESTADOS UNIDOS', code: 'USD', exchangeRate: 1.00, symbol: '$', paymentMethods: [] };


        const countrySelect = document.getElementById('country'); 
        const gameButtonsContainer = document.getElementById('gameButtonsContainer');
        const amountButtonsDiv = document.getElementById('amountButtons');
        const sellerSelect = document.getElementById('seller'); 
        const priceSummaryDiv = document.getElementById('priceSummary');
        const totalPriceDisplay = document.getElementById('totalPriceDisplay');
        const currencySymbolDisplay = document.getElementById('currencySymbolDisplay');
        const baseAmountDisplay = document.getElementById('baseAmountDisplay');
        const messageDisplay = document.getElementById('messageDisplay');
        const topupForm = document.getElementById('topupForm');
        const paymentMethodsDisplayDiv = document.getElementById('paymentMethodsDisplay');
        const paymentMethodsListDiv = document.getElementById('paymentMethodsList');
        const transferWarningMessage = document.getElementById('transferWarningMessage');
        const selectedItemsPreview = document.getElementById('selectedItemsPreview'); // Contenedor para miniaturas


        // Funci칩n para formatear n칰meros con separadores de miles y decimales (puntos y comas)
        function formatNumber(num) {
            // Convierte el n칰mero a una cadena con 2 decimales
            let formattedNum = num.toFixed(2);
            // Separa la parte entera de la parte decimal
            let parts = formattedNum.split('.');
            // Formatea la parte entera con puntos como separador de miles
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            // Junta las partes con coma como separador decimal
            return parts.join(',');
        }

        // Funci칩n para validar todos los campos y habilitar/deshabilitar el bot칩n de Confirmar Transferencia
        function updateConfirmTransferButtonState() {
            const currentGame = gameOptions.find(g => g.name === selectedGame);
            let areAllRequiredFieldsFilled = true;

            // Validaci칩n de campos din치micos
            if (currentGame) {
                switch (currentGame.inputRequirement) {
                    case 'id_name':
                        areAllRequiredFieldsFilled = userIdInput.value.trim() !== '' && userNameInput.value.trim() !== '';
                        break;
                    case 'id_server':
                        areAllRequiredFieldsFilled = userIdServerInput.value.trim() !== '' && serverInput.value.trim() !== '';
                        break;
                    case 'id_server_name': // Mobile Legends
                        areAllRequiredFieldsFilled = userIdServerInput.value.trim() !== '' && serverInput.value.trim() !== '' && userNameMLInput.value.trim() !== '';
                        break;
                    case 'id_only':
                        areAllRequiredFieldsFilled = userIdOnlyInput.value.trim() !== '';
                        break;
                    case 'cod_full':
                        areAllRequiredFieldsFilled = emailInput.value.trim() !== '' && passwordInput.value.trim() !== '' && linkageInput.value.trim() !== '' && exactAccountNameInput.value.trim() !== '';
                        break;
                    default:
                        areAllRequiredFieldsFilled = false;
                        break;
                }
            } else {
                areAllRequiredFieldsFilled = false; // Si no hay juego seleccionado, no hay campos llenos
            }

            const isGameSelected = selectedGame !== '';
            // Ahora verifica si hay UN art칤culo seleccionado
            const isAmountSelected = selectedAmount !== null; 
            const isSellerSelected = sellerSelect.value !== ''; 
            const isCountrySelected = countrySelect.value !== ''; // El pa칤s DEBE ser seleccionado

            // Validar si el ID de usuario contiene solo n칰meros (aplicar solo a campos de ID)
            let isUserIdNumeric = true;
            if (idNameInputs.style.display === 'block' && userIdInput.value.trim() !== '') {
                isUserIdNumeric = /^[0-9]*$/.test(userIdInput.value.trim());
            } else if (idServerInputs.style.display === 'block' && userIdServerInput.value.trim() !== '') {
                isUserIdNumeric = /^[0-9]*$/.test(userIdServerInput.value.trim());
            } else if (idOnlyInputs.style.display === 'block' && userIdOnlyInput.value.trim() !== '') {
                isUserIdNumeric = /^[0-9]*$/.test(userIdOnlyInput.value.trim());
            }
            
            // Validaci칩n final del bot칩n
            if (isGameSelected && isAmountSelected && isSellerSelected && isCountrySelected && areAllRequiredFieldsFilled && isUserIdNumeric) {
                confirmTransferBtn.disabled = false;
                messageDisplay.style.display = 'none'; 
            } else {
                confirmTransferBtn.disabled = true;
                if (!isCountrySelected) { // Mensaje espec칤fico para el pa칤s no seleccionado
                    showMessage('Por favor, selecciona tu pa칤s para continuar.', 'info');
                } else if (!isUserIdNumeric && (userIdInput.value.trim() || userIdServerInput.value.trim() || userIdOnlyInput.value.trim())) {
                    showMessage('El ID de Usuario (o UID) solo debe contener n칰meros.', 'error');
                } else if (!messageDisplay.textContent || messageDisplay.style.display === 'none') {
                    // Mostrar un mensaje general si no hay un error espec칤fico
                    showMessage('Por favor, completa todos los campos necesarios para confirmar la transferencia.', 'info');
                }
            }
        }


        // Funci칩n para cargar los botones de juego
        function loadGameOptions() {
            gameButtonsContainer.innerHTML = ''; 
            gameOptions.forEach(game => {
                const gameItemDiv = document.createElement('div');
                gameItemDiv.classList.add('game-item');
                gameItemDiv.dataset.gameName = game.name;

                const imgElement = document.createElement('img');
                imgElement.src = game.logoUrl || 'https://placehold.co/120x120/cccccc/000000?text=No Image'; 
                imgElement.alt = `Logo de ${game.name}`;
                imgElement.classList.add('game-logo');
                
                imgElement.onerror = function() {
                    this.onerror = null; 
                    this.src = 'https://placehold.co/120x120/cccccc/000000?text=No Image'; 
                    console.error('Failed to load game logo image:', game.logoUrl);
                };

                const nameSpan = document.createElement('span');
                nameSpan.classList.add('game-name-label');
                nameSpan.textContent = game.name;

                gameItemDiv.appendChild(imgElement);
                gameItemDiv.appendChild(nameSpan);

                gameItemDiv.addEventListener('click', () => {
                    selectedGame = game.name;
                    selectedAmount = null; // Limpiar art칤culo seleccionado al cambiar de juego
                    
                    Array.from(gameButtonsContainer.children).forEach(div => div.classList.remove('selected'));
                    gameItemDiv.classList.add('selected');

                    updateAmountSelection(); 
                    updatePriceSummary();
                    updateInputFields(); // Actualiza los campos de entrada al seleccionar un juego
                    sendWhatsAppOrderBtn.style.display = 'none';
                    messageDisplay.style.display = 'none';
                    transferWarningMessage.style.display = 'block';
                    updateConfirmTransferButtonState();

                    // Desplazamiento suave a la secci칩n de art칤culos
                    amountSelectionDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
                gameButtonsContainer.appendChild(gameItemDiv);
            });
        }

        // Funci칩n para actualizar los botones de monto con im치genes y precio local
        function updateAmountSelection() {
            amountButtonsDiv.innerHTML = ''; 
            if (selectedGame) {
                amountSelectionDiv.style.display = 'block'; 
                const currentAmounts = gameOptions.find(g => g.name === selectedGame)?.amounts;
                const countryInfo = countryData.find(c => c.name === selectedCountry) || defaultCountryInfo; 

                if (currentAmounts && currentAmounts.length > 0) {
                    currentAmounts.forEach(amount => {
                        const itemDiv = document.createElement('div'); 
                        itemDiv.classList.add('amount-item'); // Ahora amount-item ya tiene los estilos base
                        // Guardar todos los datos del art칤culo en el dataset para f치cil recuperaci칩n
                        itemDiv.dataset.value = amount.value; 
                        itemDiv.dataset.label = amount.label; 
                        itemDiv.dataset.imageUrl = amount.imageUrl; 

                        const imgElement = document.createElement('img');
                        imgElement.src = amount.imageUrl;
                        imgElement.alt = amount.label;
                        imgElement.classList.add('item-image');
                        imgElement.width = 80;
                        imgElement.height = 80;
                        imgElement.loading = 'lazy'; 
                        
                        imgElement.onerror = function() {
                            this.onerror = null; 
                            this.src = 'https://placehold.co/80x80/cccccc/000000?text=No Image'; 
                            console.error('Failed to load item image:', amount.imageUrl);
                        };

                        const itemTextContainer = document.createElement('div'); 
                        itemTextContainer.classList.add('item-text-container');

                        const labelSpan = document.createElement('span');
                        labelSpan.classList.add('item-label');
                        labelSpan.textContent = amount.label;

                        itemTextContainer.appendChild(labelSpan);

                        // L칩gica condicional para mostrar el precio: USD o moneda local
                        if (selectedCountry === '') {
                            // Mostrar solo precio en USD si no hay pa칤s seleccionado
                            const priceUsdSpan = document.createElement('span');
                            priceUsdSpan.classList.add('item-price-usd');
                            priceUsdSpan.textContent = `${amount.value.toFixed(2)} USD`; 
                            itemTextContainer.appendChild(priceUsdSpan);
                        } else {
                            // Mostrar precio en moneda local si hay pa칤s seleccionado
                            const priceLocalSpan = document.createElement('span');
                            priceLocalSpan.classList.add('item-price-local');
                            const localPrice = amount.value * countryInfo.exchangeRate;
                            priceLocalSpan.textContent = `${formatNumber(localPrice)} ${countryInfo.symbol}`; 
                            itemTextContainer.appendChild(priceLocalSpan);
                        }
                        
                        itemDiv.appendChild(imgElement);
                        itemDiv.appendChild(itemTextContainer); 

                        itemDiv.addEventListener('click', () => {
                            // Deseleccionar todos los dem치s art칤culos
                            Array.from(amountButtonsDiv.children).forEach(div => div.classList.remove('selected'));
                            
                            // Seleccionar solo este art칤culo
                            itemDiv.classList.add('selected');
                            selectedAmount = amount; // Almacenar el objeto del art칤culo seleccionado

                            updatePriceSummary();
                            sendWhatsAppOrderBtn.style.display = 'none';
                            messageDisplay.style.display = 'none'; 
                            transferWarningMessage.style.display = 'block'; 
                            updateConfirmTransferButtonState();

                            // Desplazamiento suave a la secci칩n de informaci칩n del usuario
                            userInfoSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        });

                        // Marcar como seleccionado si es el art칤culo actualmente seleccionado
                        if (selectedAmount && selectedAmount.value === amount.value && selectedAmount.label === amount.label) {
                            itemDiv.classList.add('selected');
                        }

                        amountButtonsDiv.appendChild(itemDiv);
                    });
                } else {
                    amountButtonsDiv.innerHTML = '<p style="color: #FF6347; font-weight: bold;">No hay art칤culos disponibles para este juego.</p>';
                }
            } else {
                amountSelectionDiv.style.display = 'none'; 
            }
        }

        // Funci칩n para cargar opciones de pa칤s
        function loadCountryOptions() {
            countrySelect.innerHTML = '<option value="">-- ELIGE TU PAIS --</option>';
            countryData.forEach(country => {
                const option = document.createElement('option');
                option.value = country.name;
                option.textContent = country.name;
                countrySelect.appendChild(option);
            });
            selectedCountry = ''; 
            countrySelect.value = ''; 
        }

        // Funci칩n para cargar opciones de vendedor
        function loadSellerOptions() {
            sellerData.forEach(seller => {
                const option = document.createElement('option');
                option.value = seller.name; 
                option.textContent = seller.name;
                sellerSelect.appendChild(option);
            });
        }

        // Funci칩n: Actualiza la visibilidad y requisitos de los campos de entrada
        function updateInputFields() {
            idNameInputs.style.display = 'none';
            idServerInputs.style.display = 'none';
            idOnlyInputs.style.display = 'none';
            codInputs.style.display = 'none';
            document.getElementById('mlNameInput').style.display = 'none'; 

            const allInputs = [
                userIdInput, userNameInput, userIdServerInput, serverInput, userNameMLInput,
                userIdOnlyInput, emailInput, passwordInput, linkageInput, exactAccountNameInput
            ];
            allInputs.forEach(input => {
                if (input) { 
                    input.value = '';
                    input.required = false;
                }
            });

            const currentGame = gameOptions.find(g => g.name === selectedGame);
            if (!currentGame) return;

            switch (currentGame.inputRequirement) {
                case 'id_name':
                    idNameInputs.style.display = 'block';
                    userIdInput.required = true;
                    userNameInput.required = true;
                    break;
                case 'id_server':
                    idServerInputs.style.display = 'block';
                    userIdServerInput.required = true;
                    serverInput.required = true;
                    break;
                case 'id_server_name': 
                    idServerInputs.style.display = 'block';
                    userIdServerInput.required = true;
                    serverInput.required = true;
                    document.getElementById('mlNameInput').style.display = 'block'; 
                    userNameMLInput.required = true;
                    break;
                case 'id_only':
                    idOnlyInputs.style.display = 'block';
                    userIdOnlyInput.required = true;
                    break;
                case 'cod_full':
                    codInputs.style.display = 'block';
                    emailInput.required = true;
                    passwordInput.required = true;
                    linkageInput.required = true;
                    exactAccountNameInput.required = true;
                    break;
                default:
                    break;
            }
            updateConfirmTransferButtonState(); 
        }


        // Manejadores de input para validar y restablecer botones
        [userIdInput, userNameInput, userIdServerInput, serverInput, userNameMLInput, userIdOnlyInput,
         emailInput, passwordInput, linkageInput, exactAccountNameInput].forEach(input => {
            if (input) { 
                input.addEventListener('input', () => {
                    sendWhatsAppOrderBtn.style.display = 'none';
                    messageDisplay.style.display = 'none'; 
                    transferWarningMessage.style.display = 'block'; 
                    updateConfirmTransferButtonState();
                });
            }
        });

        // Manejador de cambio de vendedor
        sellerSelect.addEventListener('change', () => {
            selectedSeller = sellerSelect.value;
            sendWhatsAppOrderBtn.style.display = 'none';
            messageDisplay.style.display = 'none'; 
            transferWarningMessage.style.display = 'block'; 
            updateConfirmTransferButtonState();
        });

        // Manejador de cambio de pa칤s
        countrySelect.addEventListener('change', () => {
            selectedCountry = countrySelect.value;
            updatePriceSummary();
            if (selectedGame) {
                updateAmountSelection(); 
            }
            sendWhatsAppOrderBtn.style.display = 'none';
            messageDisplay.style.display = 'none'; 
            transferWarningMessage.style.display = 'block'; 
            updateConfirmTransferButtonState();

            priceSummaryDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
        
        // Funci칩n para actualizar el resumen del precio y los m칠todos de pago
        function updatePriceSummary() {
            // selectedAmount ahora es un objeto o null
            let selectedAmountUSD = selectedAmount ? selectedAmount.value : 0;

            if (selectedAmountUSD > 0 && selectedCountry) {
                const countryInfo = countryData.find(country => country.name === selectedCountry); 
                
                if (!countryInfo) {
                    priceSummaryDiv.style.display = 'none'; 
                    paymentMethodsDisplayDiv.style.display = 'none'; 
                    selectedItemsPreview.innerHTML = ''; 
                    return;
                }

                totalPrice = selectedAmountUSD * countryInfo.exchangeRate;
                currencySymbol = countryInfo.symbol;
                
                totalPriceDisplay.textContent = formatNumber(totalPrice); 
                currencySymbolDisplay.textContent = currencySymbol;
                baseAmountDisplay.textContent = selectedAmountUSD.toFixed(2);
                priceSummaryDiv.style.display = 'block'; 

                // Mostrar miniatura del art칤culo seleccionado (singular)
                selectedItemsPreview.innerHTML = '';
                if (selectedAmount) {
                    const img = document.createElement('img');
                    img.src = selectedAmount.imageUrl;
                    img.alt = selectedAmount.label;
                    img.title = selectedAmount.label; 
                    img.classList.add('selected-item-thumbnail');
                    img.onerror = function() {
                        this.onerror = null; 
                        this.src = 'https://placehold.co/50x50/cccccc/000000?text=No Image'; 
                        console.error('Failed to load thumbnail image:', selectedAmount.imageUrl);
                    };
                    selectedItemsPreview.appendChild(img);
                }

                // Mostrar m칠todos de pago para el pa칤s seleccionado
                paymentMethodsListDiv.innerHTML = '';
                if (countryInfo.paymentMethods && countryInfo.paymentMethods.length > 0) {
                    paymentMethodsDisplayDiv.style.display = 'block'; 
                    countryInfo.paymentMethods.forEach(method => {
                        const p = document.createElement('p');
                        p.innerHTML = `<span>${method.name}:</span> ${method.details}`;
                        paymentMethodsListDiv.appendChild(p);
                    });
                } else {
                    paymentMethodsDisplayDiv.style.display = 'none'; 
                }

            } else {
                priceSummaryDiv.style.display = 'none'; 
                paymentMethodsDisplayDiv.style.display = 'none'; 
                selectedItemsPreview.innerHTML = ''; 
            }
        }

        // Funci칩n para mostrar mensajes al usuario
        function showMessage(msg, type) {
            messageDisplay.textContent = msg;
            messageDisplay.style.display = 'block'; 
            messageDisplay.classList.remove('message-error', 'message-success', 'message-info'); 

            if (type === 'error') {
                messageDisplay.classList.add('message-error');
            } else if (type === 'success') {
                messageDisplay.classList.add('message-success');
            } else if (type === 'info') {
                messageDisplay.classList.add('message-info');
            }
        }

        // Funci칩n para mostrar el modal de advertencia de WhatsApp
        function showWhatsAppWarningModal() {
            whatsappWarningModal.style.display = 'flex'; 
            messageDisplay.style.display = 'none'; 
        }

        // Funci칩n para ocultar el modal de advertencia de WhatsApp
        function hideWhatsAppWarningModal() {
            whatsappWarningModal.style.display = 'none'; 
        }

        // Manejador del bot칩n "Confirmar Transferencia"
        confirmTransferBtn.addEventListener('click', () => {
            if (confirmTransferBtn.disabled) {
                return;
            }

            // Realizar validaciones finales antes de mostrar el modal
            if (!selectedCountry) { showMessage('Por favor, selecciona tu pa칤s para continuar.', 'error'); return; }
            const currentGame = gameOptions.find(g => g.name === selectedGame);
            if (!currentGame) { showMessage('Por favor, selecciona un juego.', 'error'); return; }
            if (selectedAmount === null) { showMessage('Por favor, selecciona un art칤culo/monto.', 'error'); return; } // Verifica un solo art칤culo

            let isValid = true;
            let errorMessage = '';

            switch (currentGame.inputRequirement) {
                case 'id_name':
                    if (!userIdInput.value.trim() || !userNameInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Por favor, ingresa tu ID y Nombre de Jugador.';
                    } else if (!/^[0-9]*$/.test(userIdInput.value.trim())) {
                        isValid = false;
                        errorMessage = 'El ID de Jugador solo debe contener n칰meros.';
                    }
                    break;
                case 'id_server':
                    if (!userIdServerInput.value.trim() || !serverInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Por favor, ingresa el UID y el Servidor.';
                    } else if (!/^[0-9]*$/.test(userIdServerInput.value.trim())) {
                        isValid = false;
                        errorMessage = 'El UID solo debe contener n칰meros.';
                    }
                    break;
                case 'id_server_name': 
                    if (!userIdServerInput.value.trim() || !serverInput.value.trim() || !userNameMLInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Por favor, ingresa la ID, el Servidor y el Nombre de Jugador.';
                    } else if (!/^[0-9]*$/.test(userIdServerInput.value.trim())) {
                        isValid = false;
                        errorMessage = 'La ID solo debe contener n칰meros.';
                    }
                    break;
                case 'id_only':
                    if (!userIdOnlyInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Por favor, ingresa tu ID de Jugador.';
                    } else if (!/^[0-9]*$/.test(userIdOnlyInput.value.trim())) {
                        isValid = false;
                        errorMessage = 'El ID de Jugador solo debe contener n칰meros.';
                    }
                    break;
                case 'cod_full':
                    if (!emailInput.value.trim() || !passwordInput.value.trim() || !linkageInput.value.trim() || !exactAccountNameInput.value.trim()) {
                        isValid = false;
                        errorMessage = 'Por favor, completa todos los campos de Call of Duty Mobile.';
                    } else if (!emailInput.value.includes('@')) { 
                        isValid = false;
                        errorMessage = 'Por favor, ingresa un correo electr칩nico v치lido.';
                    }
                    break;
                default:
                    isValid = false;
                    errorMessage = 'Tipo de juego no reconocido o campos incompletos.';
                    break;
            }

            if (!isValid) {
                showMessage(errorMessage, 'error');
                return;
            }

            if (!sellerSelect.value) { showMessage('Por favor, selecciona un vendedor.', 'error'); return; } 
            
            showMessage('춰Transferencia confirmada! Ahora puedes enviar tu pedido por WhatsApp.', 'success');
            confirmTransferBtn.style.display = 'none'; 
            sendWhatsAppOrderBtn.style.display = 'block'; 
            transferWarningMessage.style.display = 'none'; 
        });


        // Manejador del env칤o del formulario (modificado para WhatsApp) - ahora activado por sendWhatsAppOrderBtn
        topupForm.addEventListener('submit', async (e) => {
            e.preventDefault(); 
            showWhatsAppWarningModal();
        });

        // Oyente de eventos para el bot칩n "Confirmar y Enviar" en el modal (este es el que realmente env칤a a WhatsApp)
        confirmWhatsAppBtn.addEventListener('click', async () => {
            hideWhatsAppWarningModal(); 
            loadingOverlay.style.display = 'flex'; 

            gameHidden.value = selectedGame;
            amountUSDHidden.value = selectedAmount ? selectedAmount.value : ''; 
            totalPriceHidden.value = totalPrice;
            currencySymbolHidden.value = currencySymbol;

            // Generar informaci칩n del art칤culo seleccionado para el mensaje de WhatsApp
            const selectedItemForWhatsapp = selectedAmount ? 
                `- ${selectedAmount.label} (${selectedAmount.value.toFixed(2)} USD / ${formatNumber(selectedAmount.value * (countryData.find(c => c.name === selectedCountry) || defaultCountryInfo).exchangeRate)} ${(countryData.find(c => c.name === selectedCountry) || defaultCountryInfo).symbol})` : 
                'No se seleccion칩 ning칰n art칤culo.';

            const sellerInfo = sellerData.find(seller => seller.name === selectedSeller);
            const whatsappRecipientNumber = sellerInfo ? sellerInfo.phoneNumber : DEFAULT_WHATSAPP_NUMBER; 
            
            let playerInfo = '';
            const currentGame = gameOptions.find(g => g.name === selectedGame);

            if (currentGame) {
                switch (currentGame.inputRequirement) {
                    case 'id_name':
                        playerInfo = `游 *ID del Jugador*: ${userIdInput.value.trim()}\n游녻 *Nombre del Jugador*: ${userNameInput.value.trim()}`;
                        break;
                    case 'id_server':
                        playerInfo = `游 *UID*: ${userIdServerInput.value.trim()}\n游깷 *Servidor*: ${serverInput.value.trim()}`;
                        break;
                    case 'id_server_name': 
                        playerInfo = `游 *ID del Jugador*: ${userIdServerInput.value.trim()}\n游깷 *Servidor*: ${serverInput.value.trim()}\n游녻 *Nombre del Jugador*: ${userNameMLInput.value.trim()}`;
                        break;
                    case 'id_only':
                        playerInfo = `游 *ID del Jugador*: ${userIdOnlyInput.value.trim()}`;
                        break;
                    case 'cod_full':
                        playerInfo = `游닎 *Correo*: ${emailInput.value.trim()}\n游댐 *Contrase침a*: ${passwordInput.value.trim()}\n游댕 *Vinculaci칩n*: ${linkageInput.value.trim()}\n游닇 *Nombre Exacto*: ${exactAccountNameInput.value.trim()}`;
                        break;
                    default:
                        playerInfo = 'Informaci칩n del jugador no disponible.';
                        break;
                }
            }

            const whatsappMessageContent =
                `游닇 *Pedido de Recarga - DHARCK STORE*:\n\n` +
                `${playerInfo}\n` + 
                `游눺 *Vendedor*: ${selectedSeller}\n` + 
                `游꿡 *Juego*: ${selectedGame}\n` +
                `游 *Art칤culo Seleccionado*:\n${selectedItemForWhatsapp}\n` + 
                `游눶 *Total a Pagar*: ${formatNumber(totalPrice)} ${currencySymbol}\n` + 
                `  _(Base: ${(selectedAmount ? selectedAmount.value : 0).toFixed(2)} USD + comisi칩n)_\n` + 
                `游깵 *Pa칤s*: ${selectedCountry}\n\n` +
                `丘멆잺 *춰Importante!*: Por favor, env칤ame el comprobante de pago.`;

            // Abrir WhatsApp en una nueva pesta침a/ventana
            window.open(`https://wa.me/${whatsappRecipientNumber}?text=${encodeURIComponent(whatsappMessageContent)}`, '_blank');

            // Despu칠s de un breve retraso, ocultar la animaci칩n de carga y mostrar el mensaje de 칠xito
            setTimeout(() => {
                loadingOverlay.style.display = 'none'; 
                showMessage('춰Pedido Enviado! Abre WhatsApp para confirmar.', 'success'); 

                // Opcional: Limpiar el formulario despu칠s de un env칤o exitoso
                topupForm.reset();
                selectedGame = '';
                selectedAmount = null; 
                selectedCountry = ''; 
                countrySelect.value = ''; 
                selectedSeller = ''; 
                sellerSelect.value = ''; 
                priceSummaryDiv.style.display = 'none'; 
                paymentMethodsDisplayDiv.style.display = 'none'; 
                amountSelectionDiv.style.display = 'none'; 
                amountButtonsDiv.innerHTML = '';
                selectedItemsPreview.innerHTML = ''; 
                
                // Quitar la clase 'selected' de todos los botones de juego y ocultar campos de usuario
                Array.from(gameButtonsContainer.children).forEach(div => div.classList.remove('selected'));
                // Quitar la clase 'selected' de todos los botones de art칤culo
                Array.from(amountButtonsDiv.children).forEach(div => div.classList.remove('selected'));
                updateInputFields(); 

                confirmTransferBtn.style.display = 'block';
                sendWhatsAppOrderBtn.style.display = 'none';
                transferWarningMessage.style.display = 'block'; 
                updateConfirmTransferButtonState(); 
            }, 2000); 
        });

        // Oyente de eventos para el bot칩n "Cancelar" en el modal
        cancelWhatsAppBtn.addEventListener('click', () => {
            hideWhatsAppWarningModal(); 
            showMessage('Env칤o de pedido cancelado.', 'info');
        });

       // Inicializar la p치gina cuando se carga el DOM
        document.addEventListener('DOMContentLoaded', () => {
            loadCountryOptions(); 
            loadGameOptions(); 
            loadSellerOptions(); 
            updateConfirmTransferButtonState(); 
            updateInputFields(); 
        });

    </script>
</body>
</html>
